<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>arcgis js api 记录 | RJW&#39;s Notebook</title>
    <meta name="generator" content="VuePress 1.5.3">
    <link rel="icon" href="/Notebook/images/logo.png">
    <meta name="description" content="📝每天记录一点点">
    <link rel="preload" href="/Notebook/assets/css/0.styles.2568425a.css" as="style"><link rel="preload" href="/Notebook/assets/js/app.51035dcd.js" as="script"><link rel="preload" href="/Notebook/assets/js/21.b8066a1d.js" as="script"><link rel="preload" href="/Notebook/assets/js/11.bcd53a24.js" as="script"><link rel="preload" href="/Notebook/assets/js/19.17673ac2.js" as="script"><link rel="prefetch" href="/Notebook/assets/js/2.f187326d.js"><link rel="prefetch" href="/Notebook/assets/js/3.c107e9cc.js"><link rel="prefetch" href="/Notebook/assets/js/4.195f4b4c.js"><link rel="prefetch" href="/Notebook/assets/js/5.c6e81d81.js"><link rel="prefetch" href="/Notebook/assets/js/6.f1072f55.js"><link rel="prefetch" href="/Notebook/assets/js/7.d4af47ef.js"><link rel="prefetch" href="/Notebook/assets/js/8.c5c9a92a.js"><link rel="prefetch" href="/Notebook/assets/js/9.6d199ed1.js"><link rel="prefetch" href="/Notebook/assets/js/10.88896875.js"><link rel="prefetch" href="/Notebook/assets/js/12.1b5a4e8c.js"><link rel="prefetch" href="/Notebook/assets/js/13.356cc3d0.js"><link rel="prefetch" href="/Notebook/assets/js/14.2c74c350.js"><link rel="prefetch" href="/Notebook/assets/js/15.b864e6b5.js"><link rel="prefetch" href="/Notebook/assets/js/16.30e2be76.js"><link rel="prefetch" href="/Notebook/assets/js/17.beaf0e2c.js"><link rel="prefetch" href="/Notebook/assets/js/18.13b949a3.js"><link rel="prefetch" href="/Notebook/assets/js/20.5e336d91.js">
    <link rel="stylesheet" href="/Notebook/assets/css/0.styles.2568425a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/Notebook/" class="home-link router-link-active"><!----> <span class="site-name">RJW's Notebook</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/Notebook/dailyRecord/" class="nav-link router-link-active">
  📝日常记录
</a></div><div class="nav-item"><a href="/Notebook/bookmark/" class="nav-link">
  🏷书签整理
</a></div><div class="nav-item"><a href="/Notebook/lint/" class="nav-link">
  ✔️编码规范&amp;协同开发
</a></div><div class="nav-item"><a href="http://shooterblog.site/Learn-JS-Demo/%E5%89%8D%E7%AB%AF%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  📖知识脑图
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="http://shooterblog.site" target="_blank" rel="noopener noreferrer" class="nav-link external">
  🔧个人博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/shooterRao" target="_blank" rel="noopener noreferrer" class="nav-link external">
  🔗Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/Notebook/dailyRecord/" class="nav-link router-link-active">
  📝日常记录
</a></div><div class="nav-item"><a href="/Notebook/bookmark/" class="nav-link">
  🏷书签整理
</a></div><div class="nav-item"><a href="/Notebook/lint/" class="nav-link">
  ✔️编码规范&amp;协同开发
</a></div><div class="nav-item"><a href="http://shooterblog.site/Learn-JS-Demo/%E5%89%8D%E7%AB%AF%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  📖知识脑图
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="http://shooterblog.site" target="_blank" rel="noopener noreferrer" class="nav-link external">
  🔧个人博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/shooterRao" target="_blank" rel="noopener noreferrer" class="nav-link external">
  🔗Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>日常记录</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Notebook/dailyRecord/" aria-current="page" class="sidebar-link">2022</a></li><li><a href="/Notebook/dailyRecord/2021.html" class="sidebar-link">2021</a></li><li><a href="/Notebook/dailyRecord/2020.html" class="sidebar-link">2020</a></li><li><a href="/Notebook/dailyRecord/2019.html" class="sidebar-link">2019</a></li><li><a href="/Notebook/dailyRecord/2018.html" class="sidebar-link">2018</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>interview</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Notebook/dailyRecord/interview.html" class="sidebar-link">面试复习</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="arcgis-js-api-记录"><a href="#arcgis-js-api-记录" aria-hidden="true" class="header-anchor">#</a> arcgis js api 记录</h1> <h2 id="map"><a href="#map" aria-hidden="true" class="header-anchor">#</a> Map</h2> <p>所有类都有共用 map 对象</p> <p>map: &quot;esri/map&quot;
centerAndZoom (point,级别);
toMap （转为地图坐标）
toScreen （转为屏幕坐标）</p> <p>Graphic symbol attributes</p> <p>Querytask query
IdentifyTask
Buffer
Geometryservices..</p> <h2 id="查询服务地址"><a href="#查询服务地址" aria-hidden="true" class="header-anchor">#</a> 查询服务地址</h2> <p>一般为静态服务+'/0'</p> <h2 id="根据-id-获取-layer"><a href="#根据-id-获取-layer" aria-hidden="true" class="header-anchor">#</a> 根据 id 获取 layer</h2> <p>this.map.getLayer(layerobj.serviceuid)
this.map.layerIds (地图已加载的图层 ID 列表)</p> <h2 id="createsymbol"><a href="#createsymbol" aria-hidden="true" class="header-anchor">#</a> createSymbol</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">createMarkerSymbol</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> color<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> markerSymbol <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleMarkerSymbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  markerSymbol<span class="token punctuation">.</span><span class="token function">setPath</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
  markerSymbol<span class="token punctuation">.</span><span class="token function">setColor</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">dojo<span class="token punctuation">.</span>Color</span><span class="token punctuation">(</span>color<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  markerSymbol<span class="token punctuation">.</span><span class="token function">setSize</span><span class="token punctuation">(</span><span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  markerSymbol<span class="token punctuation">.</span><span class="token function">setOutline</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> markerSymbol<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="查询"><a href="#查询" aria-hidden="true" class="header-anchor">#</a> 查询</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> query <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> queryUrl <span class="token operator">=</span>“<span class="token constant">XXX</span><span class="token operator">/</span><span class="token number">0</span>&quot;<span class="token punctuation">;</span>
<span class="token keyword">var</span> queryTask <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryTask</span><span class="token punctuation">(</span>queryUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> where <span class="token operator">=</span> xxx<span class="token punctuation">;</span>
query<span class="token punctuation">.</span>spatialRel <span class="token operator">=</span> <span class="token string">&quot;sriSpatialRelIntersects&quot;</span><span class="token punctuation">;</span>
query<span class="token punctuation">.</span>where <span class="token operator">=</span> <span class="token string">&quot;NAME like '%&quot;</span> <span class="token operator">+</span> where <span class="token operator">+</span> <span class="token string">&quot;%'&quot;</span><span class="token punctuation">;</span>
query<span class="token punctuation">.</span>returnGeometry <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token comment">// 返回地理信息</span>
query<span class="token punctuation">.</span>outFields <span class="token operator">=</span> <span class="token punctuation">[</span>&quot;<span class="token operator">*</span>”<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">// 所有字段</span>
queryTask<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>Query<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="查出结果，获取地理信息"><a href="#查出结果，获取地理信息" aria-hidden="true" class="header-anchor">#</a> 查出结果，获取地理信息</h2> <div class="language-js extra-class"><pre class="language-js"><code>resultGraphic<span class="token punctuation">.</span>geometry<span class="token punctuation">.</span><span class="token function">getExtent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="获取地理信息中心点"><a href="#获取地理信息中心点" aria-hidden="true" class="header-anchor">#</a> 获取地理信息中心点</h2> <div class="language-js extra-class"><pre class="language-js"><code>resultGraphic<span class="token punctuation">.</span>geometry<span class="token punctuation">.</span><span class="token function">getExtent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getCenter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="查询-2"><a href="#查询-2" aria-hidden="true" class="header-anchor">#</a> 查询</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 模糊查询</span>
query<span class="token punctuation">.</span>where <span class="token operator">=</span> <span class="token string">&quot;NAME like '%&quot;</span> <span class="token operator">+</span> where <span class="token operator">+</span> <span class="token string">&quot;%’&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 精确查询</span>
query<span class="token punctuation">.</span>where <span class="token operator">=</span> <span class="token string">&quot;NAME =&quot;</span> <span class="token operator">+</span> <span class="token string">&quot;\'&quot;</span> <span class="token operator">+</span> text <span class="token operator">+</span> <span class="token string">&quot;\'&quot;</span><span class="token punctuation">;</span>
query<span class="token punctuation">.</span>where <span class="token operator">=</span><span class="token string">&quot;CASETYPE = '” + name + &quot;</span><span class="token string">' and SECTION-NAME = '</span>” <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>branchName <span class="token operator">+</span> <span class="token string">&quot;' &quot;</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="_2018-06-20"><a href="#_2018-06-20" aria-hidden="true" class="header-anchor">#</a> 2018/06/20</h2> <p>1.同 id 的 graphicLayer 图层只能添加一次，不能重复添加，不然无法添加 graphic 到该 graphicLayer 上</p> <p>2.关于图层放大(定位到指定坐标)，坐标又是经过 this.map.toMap(screen 的)，然后出现偏移的问题，解决办法是先进行图层放大，然后再进行坐标转换，最后进行定位</p> <p>3.关于定位和 infoWindow show 时，控制台会出现一堆报错信息，原因是地图定位到某个点时，定位是异步的，图层还是移动，infoWindow 的 show 方法是同步的，图层未移动完成直接执行 infoWindow 的 show 方法会找不到指定的点。解决办法是 this.map.centerAt(xxx).then(function(){ infoWindow.show() })</p> <h2 id="面积计算"><a href="#面积计算" aria-hidden="true" class="header-anchor">#</a> 面积计算</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">calculateAreaByGeometry</span><span class="token punctuation">(</span>geometries<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> areasAndLengthParams <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AreasAndLengthsParameters</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  areasAndLengthParams<span class="token punctuation">.</span>lengthUnit <span class="token operator">=</span> GeometryService<span class="token punctuation">.</span><span class="token constant">UNIT_METER</span><span class="token punctuation">;</span>
  areasAndLengthParams<span class="token punctuation">.</span>areaUnit <span class="token operator">=</span> GeometryService<span class="token punctuation">.</span><span class="token constant">UNIT_SQUARE_METERS</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>_geoService<span class="token punctuation">.</span><span class="token function">simplify</span><span class="token punctuation">(</span><span class="token punctuation">[</span>geometries<span class="token punctuation">]</span><span class="token punctuation">,</span>lang<span class="token punctuation">.</span><span class="token function">hitch</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token function">functio</span> <span class="token punctuation">(</span>simplifiedGeometries<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      areasAndLengthParams<span class="token punctuation">.</span>polygons <span class="token operator">=</span> simplifiedGeometries<span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_geoService<span class="token punctuation">.</span><span class="token function">areasAndLengths</span><span class="token punctuation">(</span>areasAndLengthParams<span class="token punctuation">,</span> lang<span class="token punctuation">.</span><span class="token function">hitch</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>measurements<span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;计算：&quot;</span><span class="token operator">+</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>measurements<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>_originArea <span class="token operator">=</span> measurements<span class="token punctuation">.</span>areas<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>LandArea<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_originArea<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>LandArea<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_originArea<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h2 id="格式化返回数据格式-cad"><a href="#格式化返回数据格式-cad" aria-hidden="true" class="header-anchor">#</a> 格式化返回数据格式 cad</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">formateCadData</span><span class="token punctuation">(</span>rendererInfo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> key <span class="token keyword">in</span> rendererInfo<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;Annotation&quot;</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">var</span> _Annotation <span class="token operator">=</span> key<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;MultiPatch&quot;</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">var</span> _Multipatch <span class="token operator">=</span> key<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;Point&quot;</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">var</span> _Point <span class="token operator">=</span> key<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;Polygon&quot;</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">var</span> _Polygon <span class="token operator">=</span> key<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;Polyline&quot;</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">var</span> _Polyline <span class="token operator">=</span> key<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>_tempSOEArray <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>_Annotation <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> _Annotation <span class="token operator">!=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>_tempSOEArray<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>key<span class="token punctuation">:</span>_Annotation<span class="token punctuation">,</span>label<span class="token punctuation">:</span><span class="token string">&quot;Annotation&quot;</span><span class="token punctuation">,</span>renderer<span class="token punctuation">:</span>rendererInfo<span class="token punctuation">[</span>_Annotation<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>_Point <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> _Point <span class="token operator">!=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>_tempSOEArray<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>key<span class="token punctuation">:</span>_Point<span class="token punctuation">,</span>label<span class="token punctuation">:</span><span class="token string">&quot;Point&quot;</span><span class="token punctuation">,</span>renderer<span class="token punctuation">:</span>rendererInfo<span class="token punctuation">[</span>_Point<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>_Multipatch <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> _Multipatch <span class="token operator">!=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>_tempSOEArray<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>key<span class="token punctuation">:</span>_Multipatch<span class="token punctuation">,</span>label<span class="token punctuation">:</span><span class="token string">&quot;MultiPatch&quot;</span><span class="token punctuation">,</span>renderer<span class="token punctuation">:</span>rendererInfo<span class="token punctuation">[</span>_Multipatch<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>_Polygon <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> _Polygon <span class="token operator">!=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>_tempSOEArray<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>key<span class="token punctuation">:</span>_Polygon<span class="token punctuation">,</span>label<span class="token punctuation">:</span><span class="token string">&quot;Polygon&quot;</span><span class="token punctuation">,</span>renderer<span class="token punctuation">:</span>rendererInfo<span class="token punctuation">[</span>_Polygon<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>_Polyline <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> _Polyline <span class="token operator">!=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>_tempSOEArray<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>key<span class="token punctuation">:</span>_Polyline<span class="token punctuation">,</span>label<span class="token punctuation">:</span><span class="token string">&quot;Polyline&quot;</span><span class="token punctuation">,</span>renderer<span class="token punctuation">:</span>rendererInfo<span class="token punctuation">[</span>_Polyline<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//console.log(this._tempSOEArray);</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="生成气泡"><a href="#生成气泡" aria-hidden="true" class="header-anchor">#</a> 生成气泡</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">_createMarkerSymbol</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> color<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> markerSymbol <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleMarkerSymbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  markerSymbol<span class="token punctuation">.</span><span class="token function">setPath</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
  markerSymbol<span class="token punctuation">.</span><span class="token function">setColor</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">dojo<span class="token punctuation">.</span>Color</span><span class="token punctuation">(</span>color<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  markerSymbol<span class="token punctuation">.</span><span class="token function">setSize</span><span class="token punctuation">(</span><span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  markerSymbol<span class="token punctuation">.</span><span class="token function">setOutline</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> markerSymbol<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> bubblePath <span class="token operator">=</span>
  <span class="token string">&quot;M112.383743,306.206395 C205.990914,190.501802 240.139288,110.391573 214.974178,65.98601 C191.75978,25.0226106 152.205437,0.518809731 112.001211,0.890603622 C72.6760715,1.25426804 33.6638005,25.2983572 8.95967556,65.9989251 C-17.1771425,109.059885 17.2454444,189.168363 112.383743,306.206395 Z&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> initColor <span class="token operator">=</span> <span class="token string">&quot;#0084ff&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 生成气泡symbol</span>
<span class="token keyword">var</span> bubbleSymbol <span class="token operator">=</span> <span class="token function">_createMarkerSymbol</span><span class="token punctuation">(</span>bubblePath<span class="token punctuation">,</span> initColor<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 通用symbol样式</span>
<span class="token keyword">var</span> polygonSys <span class="token operator">=</span> <span class="token punctuation">{</span>
  style<span class="token punctuation">:</span> <span class="token string">&quot;esriSFSSolid&quot;</span><span class="token punctuation">,</span>
  color<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">79</span><span class="token punctuation">,</span> <span class="token number">129</span><span class="token punctuation">,</span> <span class="token number">189</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  type<span class="token punctuation">:</span> <span class="token string">&quot;esriSFS&quot;</span><span class="token punctuation">,</span>
  outline<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    style<span class="token punctuation">:</span> <span class="token string">&quot;esriSLSSolid&quot;</span><span class="token punctuation">,</span>
    color<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">125</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    width<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
    type<span class="token punctuation">:</span> <span class="token string">&quot;esriSLS&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> pointSys <span class="token operator">=</span> <span class="token punctuation">{</span>
  style<span class="token punctuation">:</span> <span class="token string">&quot;esriSMSCircle&quot;</span><span class="token punctuation">,</span>
  color<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  name<span class="token punctuation">:</span> <span class="token string">&quot;Circle&quot;</span><span class="token punctuation">,</span>
  outline<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    color<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    width<span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  type<span class="token punctuation">:</span> <span class="token string">&quot;esriSMS&quot;</span><span class="token punctuation">,</span>
  size<span class="token punctuation">:</span> <span class="token number">18</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> lineSys <span class="token operator">=</span> <span class="token punctuation">{</span>
  style<span class="token punctuation">:</span> <span class="token string">&quot;esriSLSSolid&quot;</span><span class="token punctuation">,</span>
  color<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  width<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  name<span class="token punctuation">:</span> <span class="token string">&quot;Red 1&quot;</span><span class="token punctuation">,</span>
  type<span class="token punctuation">:</span> <span class="token string">&quot;esriSLS&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>pointSymbol<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>pointSymbol <span class="token operator">=</span> jsonUtils<span class="token punctuation">.</span><span class="token function">fromJson</span><span class="token punctuation">(</span>pointSys<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>polylineSymbol<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>polylineSymbol <span class="token operator">=</span> jsonUtils<span class="token punctuation">.</span><span class="token function">fromJson</span><span class="token punctuation">(</span>lineSys<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>polygonSymbol<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>polygonSymbol <span class="token operator">=</span> jsonUtils<span class="token punctuation">.</span><span class="token function">fromJson</span><span class="token punctuation">(</span>polygonSys<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="加入图层"><a href="#加入图层" aria-hidden="true" class="header-anchor">#</a> 加入图层</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">this</span><span class="token punctuation">.</span>identifyGraphicLayer<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>currentGra<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 一闪一闪graphic</span>
dgpUtils<span class="token punctuation">.</span>featureAction<span class="token punctuation">.</span><span class="token function">flash</span><span class="token punctuation">(</span><span class="token punctuation">[</span>currentGra<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>identifyGraphicLayer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 定位</span>
dgpUtils<span class="token punctuation">.</span>featureAction<span class="token punctuation">.</span><span class="token function">zoomTo</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>map<span class="token punctuation">,</span> <span class="token punctuation">[</span>currentGra<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> extentFactor<span class="token punctuation">:</span> <span class="token string">&quot;2&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">setExtent</span><span class="token punctuation">(</span>geometry<span class="token punctuation">.</span><span class="token function">getExtent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">expand</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="导出-excel"><a href="#导出-excel" aria-hidden="true" class="header-anchor">#</a> 导出 excel</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">exportToExecl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">var</span> filename <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>exportData<span class="token punctuation">.</span>layerName<span class="token punctuation">,</span>
tableId <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>baseClass <span class="token operator">+</span> <span class="token string">'-table'</span><span class="token punctuation">,</span>
tableDataSource <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>exportData<span class="token punctuation">.</span>feature<span class="token punctuation">.</span>attributes<span class="token punctuation">;</span>
<span class="token comment">// console.log(this.exportData);</span>
<span class="token keyword">var</span> table <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span>tableId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>table<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  table <span class="token operator">=</span> domCon<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">'table'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token string">'id'</span><span class="token punctuation">:</span> tableId<span class="token punctuation">,</span>
  <span class="token string">'style'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
  <span class="token string">'display'</span><span class="token punctuation">:</span> <span class="token string">'none'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>domNode<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>exportTable <span class="token operator">=</span> table<span class="token punctuation">;</span>
<span class="token keyword">var</span> thead <span class="token operator">=</span> domCon<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">'thead'</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> table<span class="token punctuation">)</span><span class="token punctuation">,</span>
theadTr <span class="token operator">=</span> domCon<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">'tr'</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> thead<span class="token punctuation">)</span><span class="token punctuation">,</span>
tbody <span class="token operator">=</span> domCon<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">'tbody'</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> table<span class="token punctuation">)</span><span class="token punctuation">,</span>
tbodyTr <span class="token operator">=</span> domCon<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">'tr'</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> tbody<span class="token punctuation">)</span><span class="token punctuation">;</span>
array<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>tableDataSource<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  domCon<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">'th'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> innerHTML<span class="token punctuation">:</span> key <span class="token punctuation">}</span><span class="token punctuation">,</span> theadTr<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> value <span class="token operator">=</span> lang<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span>tableDataSource<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  domCon<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">'td'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> innerHTML<span class="token punctuation">:</span> value <span class="token punctuation">}</span><span class="token punctuation">,</span> tbodyTr<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">ExportToExcel</span><span class="token punctuation">(</span><span class="token punctuation">[</span>tableId<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>filename<span class="token punctuation">]</span><span class="token punctuation">,</span> filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
  domCon<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span>table<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="i-查询"><a href="#i-查询" aria-hidden="true" class="header-anchor">#</a> I 查询</h2> <div class="language-js extra-class"><pre class="language-js"><code>_IdentifyOneByOne<span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>geometry<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">var</span> QueryConfig <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>config<span class="token punctuation">.</span>queryconfig<span class="token punctuation">;</span>
<span class="token keyword">var</span> layerItem <span class="token operator">=</span> QueryConfig<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> _this <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> identifyTask <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IdentifyTask</span><span class="token punctuation">(</span>layerItem<span class="token punctuation">.</span><span class="token constant">URL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> identifyParams <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IdentifyParameters</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
identifyParams<span class="token punctuation">.</span>tolerance <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
identifyParams<span class="token punctuation">.</span>returnGeometry <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
identifyParams<span class="token punctuation">.</span>spatialReference <span class="token operator">=</span> _this<span class="token punctuation">.</span>map<span class="token punctuation">.</span>extent<span class="token punctuation">.</span>spatialReference<span class="token punctuation">;</span>
identifyParams<span class="token punctuation">.</span>geometry <span class="token operator">=</span> geometry<span class="token punctuation">;</span>
<span class="token comment">// layerIds ‘[1,2]‘ 传入图层Id</span>
identifyParams<span class="token punctuation">.</span>layerIds <span class="token operator">=</span> layerItem<span class="token punctuation">.</span>queryLayers<span class="token punctuation">;</span>
identifyParams<span class="token punctuation">.</span>layerOption <span class="token operator">=</span> IdentifyParameters<span class="token punctuation">.</span><span class="token constant">LAYER_OPTION_ALL</span><span class="token punctuation">;</span>
identifyParams<span class="token punctuation">.</span>mapExtent <span class="token operator">=</span> _this<span class="token punctuation">.</span>map<span class="token punctuation">.</span>extent<span class="token punctuation">;</span>
identifyTask<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>identifyParams<span class="token punctuation">,</span> lang<span class="token punctuation">.</span><span class="token function">hitch</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>results<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>results<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  _this<span class="token punctuation">.</span>isResult <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  data<span class="token punctuation">.</span>results <span class="token operator">=</span> results<span class="token punctuation">;</span>
  data<span class="token punctuation">.</span>layerItem <span class="token operator">=</span> layerItem<span class="token punctuation">;</span>
  _this<span class="token punctuation">.</span><span class="token function">_dataClassification</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> QueryConfig<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  _this<span class="token punctuation">.</span><span class="token function">_IdentifyOneByOne</span><span class="token punctuation">(</span>geometry<span class="token punctuation">,</span> index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  _this<span class="token punctuation">.</span><span class="token function">_showQueryResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h2 id="绘制缓冲区"><a href="#绘制缓冲区" aria-hidden="true" class="header-anchor">#</a> 绘制缓冲区</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">doBuffer</span><span class="token punctuation">(</span>bufferRange<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">//缓冲区查询返回新的geometry</span>
<span class="token keyword">var</span> bufferParams <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferParameters</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> geometry <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_beforeBufferGeometry<span class="token punctuation">;</span>
bufferParams<span class="token punctuation">.</span>distances <span class="token operator">=</span> <span class="token punctuation">[</span>bufferRange<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">// 距离</span>
bufferParams<span class="token punctuation">.</span>outSpatialReference <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>map<span class="token punctuation">.</span>spatialReference<span class="token punctuation">;</span>
bufferParams<span class="token punctuation">.</span>geometries <span class="token operator">=</span> <span class="token punctuation">[</span>geometry<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">// geometry</span>
bufferParams<span class="token punctuation">.</span>unit <span class="token operator">=</span> GeometryService<span class="token punctuation">.</span><span class="token constant">UNIT_METER</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>_geoService<span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span>bufferParams<span class="token punctuation">,</span> lang<span class="token punctuation">.</span><span class="token function">hitch</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>results<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>results<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> bufferGeometry <span class="token operator">=</span> results<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_showBufferGeometry</span><span class="token punctuation">(</span>bufferGeometry<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//展示缓冲区域</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_bufferGeometry <span class="token operator">=</span> bufferGeometry<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h2 id="获取打开的专题"><a href="#获取打开的专题" aria-hidden="true" class="header-anchor">#</a> 获取打开的专题</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">this</span><span class="token punctuation">.</span>topicManager<span class="token punctuation">.</span><span class="token function">getOpenedTopics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</code></pre></div><h2 id="关于调用-soe-服务，如何传-rings？"><a href="#关于调用-soe-服务，如何传-rings？" aria-hidden="true" class="header-anchor">#</a> 关于调用 SOE 服务，如何传 rings？</h2> <p>绘制完成后，如果要加缓冲区，先调用计算缓冲区的服务，计算出根据绘制后的 geometry 和当前的缓冲范围，再配置参数传给 SOE</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 核心代码</span>
<span class="token keyword">var</span> bufferParams <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferParameters</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> geometry <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_bufferGeometry<span class="token punctuation">;</span> <span class="token comment">// 绘制的几何信息</span>
bufferParams<span class="token punctuation">.</span>distances <span class="token operator">=</span> <span class="token punctuation">[</span>bufferRange<span class="token punctuation">]</span><span class="token punctuation">;</span>
bufferParams<span class="token punctuation">.</span>outSpatialReference <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>map<span class="token punctuation">.</span>spatialReference<span class="token punctuation">;</span>
bufferParams<span class="token punctuation">.</span>geometries <span class="token operator">=</span> <span class="token punctuation">[</span>geometry<span class="token punctuation">]</span><span class="token punctuation">;</span>
bufferParams<span class="token punctuation">.</span>unit <span class="token operator">=</span> GeometryService<span class="token punctuation">.</span><span class="token constant">UNIT_METER</span><span class="token punctuation">;</span>
<span class="token comment">// 计算缓存区，得到几何信息</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>_geoService<span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span>
  bufferParams<span class="token punctuation">,</span>
  lang<span class="token punctuation">.</span><span class="token function">hitch</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>results<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> bufferGeometry <span class="token operator">=</span> results<span class="token punctuation">;</span>
      <span class="token comment">// 展示缓冲区域</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_showBufferGeometry</span><span class="token punctuation">(</span>bufferGeometry<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_bufferGeometry <span class="token operator">=</span> bufferGeometry<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="to-top"><svg t="1547627942927" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1955" xmlns:xlink="http://www.w3.org/1999/xlink" width="64" height="64" class="icon"><path d="M752.736 431.063C757.159 140.575 520.41 8.97 504.518 0.41V0l-0.45 0.205-0.41-0.205v0.41c-15.934 8.56-252.723 140.165-248.259 430.653-48.21 31.457-98.713 87.368-90.685 184.074 8.028 96.666 101.007 160.768 136.601 157.287 35.595-3.482 25.232-30.31 25.232-30.31l12.206-50.095s52.47 80.569 69.304 80.528c15.114-1.23 87-0.123 95.6 0h0.82c8.602-0.123 80.486-1.23 95.6 0 16.794 0 69.305-80.528 69.305-80.528l12.165 50.094s-10.322 26.83 25.272 30.31c35.595 3.482 128.574-60.62 136.602-157.286 8.028-96.665-42.475-152.617-90.685-184.074z m-248.669-4.26c-6.758-0.123-94.781-3.359-102.891-107.192 2.95-98.714 95.97-107.438 102.891-107.93 6.964 0.492 99.943 9.216 102.892 107.93-8.11 103.833-96.174 107.07-102.892 107.192z m-52.019 500.531c0 11.838-9.42 21.382-21.012 21.382a21.217 21.217 0 0 1-21.054-21.34V821.74c0-11.797 9.421-21.382 21.054-21.382 11.591 0 21.012 9.585 21.012 21.382v105.635z m77.333 57.222a21.504 21.504 0 0 1-21.34 21.626 21.504 21.504 0 0 1-21.34-21.626V827.474c0-11.96 9.543-21.668 21.299-21.668 11.796 0 21.38 9.708 21.38 21.668v157.082z m71.147-82.043c0 11.796-9.42 21.34-21.053 21.34a21.217 21.217 0 0 1-21.013-21.34v-75.367c0-11.755 9.421-21.299 21.013-21.299 11.632 0 21.053 9.544 21.053 21.3v75.366z" fill="#3eaf7c" p-id="1956"></path></svg></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">1/16/2019, 4:29:15 PM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/Notebook/assets/js/app.51035dcd.js" defer></script><script src="/Notebook/assets/js/21.b8066a1d.js" defer></script><script src="/Notebook/assets/js/11.bcd53a24.js" defer></script><script src="/Notebook/assets/js/19.17673ac2.js" defer></script>
  </body>
</html>
