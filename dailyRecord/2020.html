<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>2020 | RJW&#39;s Notebook</title>
    <meta name="generator" content="VuePress 1.5.3">
    <link rel="icon" href="/Notebook/images/logo.png">
    <meta name="description" content="📝每天记录一点点">
    <link rel="preload" href="/Notebook/assets/css/0.styles.2568425a.css" as="style"><link rel="preload" href="/Notebook/assets/js/app.51035dcd.js" as="script"><link rel="preload" href="/Notebook/assets/js/21.b8066a1d.js" as="script"><link rel="preload" href="/Notebook/assets/js/15.b864e6b5.js" as="script"><link rel="preload" href="/Notebook/assets/js/19.17673ac2.js" as="script"><link rel="prefetch" href="/Notebook/assets/js/2.f187326d.js"><link rel="prefetch" href="/Notebook/assets/js/3.c107e9cc.js"><link rel="prefetch" href="/Notebook/assets/js/4.195f4b4c.js"><link rel="prefetch" href="/Notebook/assets/js/5.c6e81d81.js"><link rel="prefetch" href="/Notebook/assets/js/6.f1072f55.js"><link rel="prefetch" href="/Notebook/assets/js/7.d4af47ef.js"><link rel="prefetch" href="/Notebook/assets/js/8.c5c9a92a.js"><link rel="prefetch" href="/Notebook/assets/js/9.6d199ed1.js"><link rel="prefetch" href="/Notebook/assets/js/10.88896875.js"><link rel="prefetch" href="/Notebook/assets/js/11.bcd53a24.js"><link rel="prefetch" href="/Notebook/assets/js/12.1b5a4e8c.js"><link rel="prefetch" href="/Notebook/assets/js/13.356cc3d0.js"><link rel="prefetch" href="/Notebook/assets/js/14.2c74c350.js"><link rel="prefetch" href="/Notebook/assets/js/16.30e2be76.js"><link rel="prefetch" href="/Notebook/assets/js/17.beaf0e2c.js"><link rel="prefetch" href="/Notebook/assets/js/18.13b949a3.js"><link rel="prefetch" href="/Notebook/assets/js/20.5e336d91.js">
    <link rel="stylesheet" href="/Notebook/assets/css/0.styles.2568425a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/Notebook/" class="home-link router-link-active"><!----> <span class="site-name">RJW's Notebook</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/Notebook/dailyRecord/" class="nav-link router-link-active">
  📝日常记录
</a></div><div class="nav-item"><a href="/Notebook/bookmark/" class="nav-link">
  🏷书签整理
</a></div><div class="nav-item"><a href="/Notebook/lint/" class="nav-link">
  ✔️编码规范&amp;协同开发
</a></div><div class="nav-item"><a href="http://shooterblog.site/Learn-JS-Demo/%E5%89%8D%E7%AB%AF%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  📖知识脑图
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="http://shooterblog.site" target="_blank" rel="noopener noreferrer" class="nav-link external">
  🔧个人博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/shooterRao" target="_blank" rel="noopener noreferrer" class="nav-link external">
  🔗Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/Notebook/dailyRecord/" class="nav-link router-link-active">
  📝日常记录
</a></div><div class="nav-item"><a href="/Notebook/bookmark/" class="nav-link">
  🏷书签整理
</a></div><div class="nav-item"><a href="/Notebook/lint/" class="nav-link">
  ✔️编码规范&amp;协同开发
</a></div><div class="nav-item"><a href="http://shooterblog.site/Learn-JS-Demo/%E5%89%8D%E7%AB%AF%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  📖知识脑图
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="http://shooterblog.site" target="_blank" rel="noopener noreferrer" class="nav-link external">
  🔧个人博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/shooterRao" target="_blank" rel="noopener noreferrer" class="nav-link external">
  🔗Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>日常记录</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Notebook/dailyRecord/" aria-current="page" class="sidebar-link">2022</a></li><li><a href="/Notebook/dailyRecord/2021.html" class="sidebar-link">2021</a></li><li><a href="/Notebook/dailyRecord/2020.html" aria-current="page" class="active sidebar-link">2020</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Notebook/dailyRecord/2020.html#一月" class="sidebar-link">一月</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Notebook/dailyRecord/2020.html#运行时设置-webpack-的-publicpath" class="sidebar-link">运行时设置 webpack 的 publicPath</a></li></ul></li><li class="sidebar-sub-header"><a href="/Notebook/dailyRecord/2020.html#二月" class="sidebar-link">二月</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Notebook/dailyRecord/2020.html#大文件上传切片方法" class="sidebar-link">大文件上传切片方法</a></li><li class="sidebar-sub-header"><a href="/Notebook/dailyRecord/2020.html#javascript-判断整型的方法" class="sidebar-link">JavaScript 判断整型的方法</a></li><li class="sidebar-sub-header"><a href="/Notebook/dailyRecord/2020.html#如何在-html-上实现重定向？" class="sidebar-link">如何在 html 上实现重定向？</a></li></ul></li><li class="sidebar-sub-header"><a href="/Notebook/dailyRecord/2020.html#三月" class="sidebar-link">三月</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Notebook/dailyRecord/2020.html#docker-nginx-容器如何访问宿主机" class="sidebar-link">docker nginx 容器如何访问宿主机</a></li><li class="sidebar-sub-header"><a href="/Notebook/dailyRecord/2020.html#vscode-vue-文件中无法识别-xxx-文件路径" class="sidebar-link">vscode vue 文件中无法识别&quot;@/xxx&quot;文件路径</a></li><li class="sidebar-sub-header"><a href="/Notebook/dailyRecord/2020.html#使用对象填充数组" class="sidebar-link">使用对象填充数组</a></li></ul></li><li class="sidebar-sub-header"><a href="/Notebook/dailyRecord/2020.html#四月" class="sidebar-link">四月</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Notebook/dailyRecord/2020.html#如何设计一个同时支持具名插槽和默认插槽的-vue-组件" class="sidebar-link">如何设计一个同时支持具名插槽和默认插槽的 vue 组件</a></li><li class="sidebar-sub-header"><a href="/Notebook/dailyRecord/2020.html#如何在-eslintrc-js-中配置-prettier-规则" class="sidebar-link">如何在 .eslintrc.js 中配置 prettier 规则</a></li><li class="sidebar-sub-header"><a href="/Notebook/dailyRecord/2020.html#使用-emoji-设置-网页的-favicon-的方法" class="sidebar-link">使用 emoji 设置 网页的 favicon 的方法</a></li><li class="sidebar-sub-header"><a href="/Notebook/dailyRecord/2020.html#计算-scrollbar-宽度的方法" class="sidebar-link">计算 scrollbar 宽度的方法</a></li><li class="sidebar-sub-header"><a href="/Notebook/dailyRecord/2020.html#pipe-promise" class="sidebar-link">pipe-promise</a></li></ul></li><li class="sidebar-sub-header"><a href="/Notebook/dailyRecord/2020.html#五月" class="sidebar-link">五月</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Notebook/dailyRecord/2020.html#iview-modal-组件-slot-重渲染" class="sidebar-link">iview Modal 组件 slot 重渲染</a></li><li class="sidebar-sub-header"><a href="/Notebook/dailyRecord/2020.html#如何用-this-xxx-方式挂载-vue-组件" class="sidebar-link">如何用 this.\\\$xxx 方式挂载 vue 组件</a></li></ul></li><li class="sidebar-sub-header"><a href="/Notebook/dailyRecord/2020.html#六月" class="sidebar-link">六月</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Notebook/dailyRecord/2020.html#typescript-中的元组" class="sidebar-link">typeScript 中的元组</a></li><li class="sidebar-sub-header"><a href="/Notebook/dailyRecord/2020.html#yarn-link-出现-permission-denied" class="sidebar-link">yarn link 出现 permission denied</a></li><li class="sidebar-sub-header"><a href="/Notebook/dailyRecord/2020.html#object-is-polyfill" class="sidebar-link">Object.is polyfill</a></li><li class="sidebar-sub-header"><a href="/Notebook/dailyRecord/2020.html#yarn-link-之后可执行命令存在哪里" class="sidebar-link">yarn link 之后可执行命令存在哪里</a></li></ul></li><li class="sidebar-sub-header"><a href="/Notebook/dailyRecord/2020.html#七月" class="sidebar-link">七月</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Notebook/dailyRecord/2020.html#转译函数" class="sidebar-link">转译函数</a></li><li class="sidebar-sub-header"><a href="/Notebook/dailyRecord/2020.html#nodejs-一些路径变量" class="sidebar-link">nodejs 一些路径变量</a></li><li class="sidebar-sub-header"><a href="/Notebook/dailyRecord/2020.html#模块重定向" class="sidebar-link">模块重定向</a></li><li class="sidebar-sub-header"><a href="/Notebook/dailyRecord/2020.html#ts-使用-fs-promises" class="sidebar-link">ts 使用 fs.promises</a></li><li class="sidebar-sub-header"><a href="/Notebook/dailyRecord/2020.html#查看远程-npm-包最新版本" class="sidebar-link">查看远程 npm 包最新版本</a></li><li class="sidebar-sub-header"><a href="/Notebook/dailyRecord/2020.html#docker-nginx-容器-hjson-中文乱码" class="sidebar-link">docker nginx 容器 hjson 中文乱码</a></li><li class="sidebar-sub-header"><a href="/Notebook/dailyRecord/2020.html#获取项目部署路径" class="sidebar-link">获取项目部署路径</a></li><li class="sidebar-sub-header"><a href="/Notebook/dailyRecord/2020.html#nodejs-判断文件或者目录是否存在的" class="sidebar-link">nodejs 判断文件或者目录是否存在的</a></li><li class="sidebar-sub-header"><a href="/Notebook/dailyRecord/2020.html#nodejs-集体导出模块的方法" class="sidebar-link">nodejs 集体导出模块的方法</a></li></ul></li><li class="sidebar-sub-header"><a href="/Notebook/dailyRecord/2020.html#八月" class="sidebar-link">八月</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Notebook/dailyRecord/2020.html#docker-如何不使用缓存重建镜像" class="sidebar-link">docker 如何不使用缓存重建镜像</a></li><li class="sidebar-sub-header"><a href="/Notebook/dailyRecord/2020.html#判断空对象的方法" class="sidebar-link">判断空对象的方法</a></li><li class="sidebar-sub-header"><a href="/Notebook/dailyRecord/2020.html#es6-判断-2-个对象是否相等" class="sidebar-link">ES6 判断 2 个对象是否相等</a></li><li class="sidebar-sub-header"><a href="/Notebook/dailyRecord/2020.html#过滤对象某个-key-值" class="sidebar-link">过滤对象某个 key 值</a></li><li class="sidebar-sub-header"><a href="/Notebook/dailyRecord/2020.html#babel-是怎么实现-const-和-let-块级作用域的" class="sidebar-link">babel 是怎么实现 const 和 let 块级作用域的</a></li><li class="sidebar-sub-header"><a href="/Notebook/dailyRecord/2020.html#ts-get-函数正确写法" class="sidebar-link">ts get 函数正确写法</a></li><li class="sidebar-sub-header"><a href="/Notebook/dailyRecord/2020.html#nodejs-拉取远端图片保存本地基础写法" class="sidebar-link">nodejs 拉取远端图片保存本地基础写法</a></li></ul></li><li class="sidebar-sub-header"><a href="/Notebook/dailyRecord/2020.html#九月" class="sidebar-link">九月</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Notebook/dailyRecord/2020.html#浏览器如何检测系统主题色" class="sidebar-link">浏览器如何检测系统主题色</a></li><li class="sidebar-sub-header"><a href="/Notebook/dailyRecord/2020.html#前端如何下载-base64-字符串图片" class="sidebar-link">前端如何下载 base64 字符串图片</a></li><li class="sidebar-sub-header"><a href="/Notebook/dailyRecord/2020.html#生成区间的随机数" class="sidebar-link">生成区间的随机数</a></li><li class="sidebar-sub-header"><a href="/Notebook/dailyRecord/2020.html#chrome-开启-pause-on-exceptions" class="sidebar-link">chrome 开启 pause on exceptions</a></li></ul></li><li class="sidebar-sub-header"><a href="/Notebook/dailyRecord/2020.html#十月" class="sidebar-link">十月</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Notebook/dailyRecord/2020.html#查看项目-node-modules-文件夹大小" class="sidebar-link">查看项目 node_modules 文件夹大小</a></li><li class="sidebar-sub-header"><a href="/Notebook/dailyRecord/2020.html#vue-devtool-无法显示使用-mount-动态挂载的组件解决方法" class="sidebar-link">vue-devtool 无法显示使用 $mount 动态挂载的组件解决方法</a></li><li class="sidebar-sub-header"><a href="/Notebook/dailyRecord/2020.html#本地图片预览" class="sidebar-link">本地图片预览</a></li><li class="sidebar-sub-header"><a href="/Notebook/dailyRecord/2020.html#nginx-开启负载均衡" class="sidebar-link">nginx 开启负载均衡</a></li><li class="sidebar-sub-header"><a href="/Notebook/dailyRecord/2020.html#一行代码实现评分组件" class="sidebar-link">一行代码实现评分组件</a></li></ul></li><li class="sidebar-sub-header"><a href="/Notebook/dailyRecord/2020.html#十一月" class="sidebar-link">十一月</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Notebook/dailyRecord/2020.html#nodejs-一些路径常识" class="sidebar-link">nodejs 一些路径常识</a></li><li class="sidebar-sub-header"><a href="/Notebook/dailyRecord/2020.html#在-node-中不能使用exports-xxx的原因" class="sidebar-link">在 node 中不能使用exports=xxx的原因</a></li><li class="sidebar-sub-header"><a href="/Notebook/dailyRecord/2020.html#isnan-和-number-isnan-的区别" class="sidebar-link">isNaN 和 Number.isNaN 的区别</a></li><li class="sidebar-sub-header"><a href="/Notebook/dailyRecord/2020.html#chrome-devtool-network-请求时序信息" class="sidebar-link">chrome devtool network 请求时序信息</a></li><li class="sidebar-sub-header"><a href="/Notebook/dailyRecord/2020.html#关于vue的key几个问题讨论" class="sidebar-link">关于vue的key几个问题讨论</a></li><li class="sidebar-sub-header"><a href="/Notebook/dailyRecord/2020.html#vue-diff算法相关分析" class="sidebar-link">vue diff算法相关分析</a></li></ul></li><li class="sidebar-sub-header"><a href="/Notebook/dailyRecord/2020.html#十二月" class="sidebar-link">十二月</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Notebook/dailyRecord/2020.html#base64是什么？" class="sidebar-link">base64是什么？</a></li><li class="sidebar-sub-header"><a href="/Notebook/dailyRecord/2020.html#异步模块打包执行流程" class="sidebar-link">异步模块打包执行流程</a></li><li class="sidebar-sub-header"><a href="/Notebook/dailyRecord/2020.html#webpack-模块在运行时是怎么存的？" class="sidebar-link">webpack 模块在运行时是怎么存的？</a></li><li class="sidebar-sub-header"><a href="/Notebook/dailyRecord/2020.html#webpack-持久化-chunk-缓存方案" class="sidebar-link">webpack 持久化 chunk 缓存方案</a></li><li class="sidebar-sub-header"><a href="/Notebook/dailyRecord/2020.html#如果获取页面fp和fcp的时间" class="sidebar-link">如果获取页面FP和FCP的时间</a></li></ul></li></ul></li><li><a href="/Notebook/dailyRecord/2019.html" class="sidebar-link">2019</a></li><li><a href="/Notebook/dailyRecord/2018.html" class="sidebar-link">2018</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>interview</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Notebook/dailyRecord/interview.html" class="sidebar-link">面试复习</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_2020"><a href="#_2020" aria-hidden="true" class="header-anchor">#</a> 2020</h1> <h2 id="一月"><a href="#一月" aria-hidden="true" class="header-anchor">#</a> 一月</h2> <h3 id="运行时设置-webpack-的-publicpath"><a href="#运行时设置-webpack-的-publicpath" aria-hidden="true" class="header-anchor">#</a> 运行时设置 webpack 的 publicPath</h3> <p><code>publicPath</code> 是 webpack 提供的配置公共路径的地方，可以通过它来指定应用程序中所有资源的基础路径，如果我们想要运行时设置<code>publicPath</code>，可以通过动态设置<code>__webpack_public_path__</code>来实现</p> <p>在<code>app.js</code>中：</p> <div class="language-js extra-class"><pre class="language-js"><code>__webpack_public_path__ <span class="token operator">=</span> <span class="token string">'/public/'</span><span class="token punctuation">;</span>

<span class="token comment">// 打包后对应的变量名</span>
__webpack_require__<span class="token punctuation">.</span>p <span class="token operator">=</span> <span class="token string">'/public/'</span><span class="token punctuation">;</span>
</code></pre></div><p>在打包后，会有一个<code>__webpack_require__.p</code>变量来保存最新设置的值</p> <h2 id="二月"><a href="#二月" aria-hidden="true" class="header-anchor">#</a> 二月</h2> <h3 id="大文件上传切片方法"><a href="#大文件上传切片方法" aria-hidden="true" class="header-anchor">#</a> 大文件上传切片方法</h3> <p>前端上传打文件的时候，一般都会用切片上传的方式，核心主要是用<code>Blob.prototype.slice</code>进行切片，这个方法可以返回一个新的切片<code>Blob</code>对象，前端处理这么写：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">createFileChunk</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> size <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> fileChunkList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> cur <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>cur <span class="token operator">&lt;</span> file<span class="token punctuation">.</span>size<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fileChunkList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token comment">// 利用 Blob.prototype.slice 切片</span>
      file<span class="token punctuation">:</span> file<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>cur<span class="token punctuation">,</span> cur <span class="token operator">+</span> size<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cur <span class="token operator">+=</span> size<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> fileChunkList<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="javascript-判断整型的方法"><a href="#javascript-判断整型的方法" aria-hidden="true" class="header-anchor">#</a> JavaScript 判断整型的方法</h3> <p>es5：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">isInteger</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">===</span> x<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>es6：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">isInteger</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> Number<span class="token punctuation">.</span><span class="token function">isInteger</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="如何在-html-上实现重定向？"><a href="#如何在-html-上实现重定向？" aria-hidden="true" class="header-anchor">#</a> 如何在 html 上实现重定向？</h3> <p>使用<code>meta content url</code>方法，<code>http-equiv=&quot;refresh&quot;</code>定义文档自动刷新的时间间隔(多少秒)，设置在<code>content</code>里<code>url</code>的前面</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype">&lt;!DOCTYPE html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>refresh<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>0;url=xxx<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="三月"><a href="#三月" aria-hidden="true" class="header-anchor">#</a> 三月</h2> <h3 id="docker-nginx-容器如何访问宿主机"><a href="#docker-nginx-容器如何访问宿主机" aria-hidden="true" class="header-anchor">#</a> docker nginx 容器如何访问宿主机</h3> <p>在用 docker nginx 进行反向代理本地一些服务的时候，默认用 localhost 是直接访问容器的本身，所以要在 nginx 的 conf 文件中配置指定的 ip 地址，但是网络切换的话，ip 会变，所以只能修改配置文件进行重启这个容器，其实不方便，那么有什么办法可以省去这步骤呢？</p> <ul><li>在 mac desktop 环境中，可以用<code>host.docker.internal</code>来获取到宿主机的 ip 地址</li> <li>在 linux 环境中，可以<code>--network host</code>模式启动容器</li></ul> <p>在 mac 环境中，nginx 的 conf 文件中可以这么写了：</p> <div class="language- extra-class"><pre class="language-text"><code>location / {
  proxy_pass http://host.docker.internal:5505/;
}
</code></pre></div><h3 id="vscode-vue-文件中无法识别-xxx-文件路径"><a href="#vscode-vue-文件中无法识别-xxx-文件路径" aria-hidden="true" class="header-anchor">#</a> vscode vue 文件中无法识别&quot;@/xxx&quot;文件路径</h3> <p>使用 <code>jsconfig.json</code> 解决</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;compilerOptions&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;baseUrl&quot;</span><span class="token operator">:</span> <span class="token string">&quot;.&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;paths&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;@/*&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;./src/*&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token property">&quot;g6/*&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;./src/g6/*&quot;</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;target&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ES6&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;module&quot;</span><span class="token operator">:</span> <span class="token string">&quot;commonjs&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;allowSyntheticDefaultImports&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;include&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;src/**/*&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;exclude&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;node_modules&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="使用对象填充数组"><a href="#使用对象填充数组" aria-hidden="true" class="header-anchor">#</a> 使用对象填充数组</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> length <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> resultA <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token keyword">from</span><span class="token punctuation">(</span><span class="token punctuation">{</span> length <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> resultB <span class="token operator">=</span> <span class="token function">Array</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

resultA<span class="token punctuation">;</span> <span class="token comment">// =&gt; [{}, {}, {}]</span>
resultB<span class="token punctuation">;</span> <span class="token comment">// =&gt; [{}, {}, {}]</span>

resultA<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> resultA<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; false</span>
resultB<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">===</span> resultB<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; true</span>
</code></pre></div><p>由此可见，用<code>Array.from</code>比<code>fill</code>方法更好，可以避免由于相同对象引起的一些麻烦。</p> <h2 id="四月"><a href="#四月" aria-hidden="true" class="header-anchor">#</a> 四月</h2> <h3 id="如何设计一个同时支持具名插槽和默认插槽的-vue-组件"><a href="#如何设计一个同时支持具名插槽和默认插槽的-vue-组件" aria-hidden="true" class="header-anchor">#</a> 如何设计一个同时支持具名插槽和默认插槽的 vue 组件</h3> <p>如果想要开发一个同时支持具体插槽和默认插槽的 vue 组件，关键在于如何判断组件是否使用了默认插槽，也就是加个判断：</p> <div class="language-js extra-class"><pre class="language-js"><code>computed<span class="token punctuation">:</span> <span class="token punctuation">{</span>
  <span class="token function">hasSlotDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 组件内如果没内容，$slots.default 为 undefined</span>
    <span class="token keyword">return</span> <span class="token operator">!</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>$slots<span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>模板写法：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>project-main<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>!hasSlotDefault<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>menu<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>menu<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">v-else</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="如何在-eslintrc-js-中配置-prettier-规则"><a href="#如何在-eslintrc-js-中配置-prettier-规则" aria-hidden="true" class="header-anchor">#</a> 如何在 .eslintrc.js 中配置 prettier 规则</h3> <div class="language-js extra-class"><pre class="language-js"><code>rules<span class="token punctuation">:</span> <span class="token punctuation">{</span>
  <span class="token string">'prettier/prettier'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> singleQuote<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="使用-emoji-设置-网页的-favicon-的方法"><a href="#使用-emoji-设置-网页的-favicon-的方法" aria-hidden="true" class="header-anchor">#</a> 使用 emoji 设置 网页的 favicon 的方法</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">setFavicon</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> favicon <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'link[rel=&quot;icon&quot;]'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>favicon<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    favicon<span class="token punctuation">.</span>href <span class="token operator">=</span> url<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> link <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'link'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    link<span class="token punctuation">.</span>rel <span class="token operator">=</span> <span class="token string">'icon'</span><span class="token punctuation">;</span>
    link<span class="token punctuation">.</span>href <span class="token operator">=</span> url<span class="token punctuation">;</span>

    document<span class="token punctuation">.</span>head<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>link<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">emojiFavicon</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>emoji<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'canvas'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token number">64</span><span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">64</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> context <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  context<span class="token punctuation">.</span>font <span class="token operator">=</span> <span class="token string">'64px serif'</span><span class="token punctuation">;</span>
  context<span class="token punctuation">.</span><span class="token function">fillText</span><span class="token punctuation">(</span>emoji<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> url <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">toDataURL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">setFavicon</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Usage</span>
<span class="token function">emojiFavicon</span><span class="token punctuation">(</span><span class="token string">'🎉'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="计算-scrollbar-宽度的方法"><a href="#计算-scrollbar-宽度的方法" aria-hidden="true" class="header-anchor">#</a> 计算 scrollbar 宽度的方法</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">calculateScrollbarWidth</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> outer <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  outer<span class="token punctuation">.</span>style<span class="token punctuation">.</span>visibility <span class="token operator">=</span> <span class="token string">'hidden'</span><span class="token punctuation">;</span>
  outer<span class="token punctuation">.</span>style<span class="token punctuation">.</span>overflow <span class="token operator">=</span> <span class="token string">'scroll'</span><span class="token punctuation">;</span>

  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>outer<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> inner <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  outer<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>inner<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 里外宽度相减得出滚动条的宽度</span>
  <span class="token keyword">const</span> scrollbarWidth <span class="token operator">=</span> outer<span class="token punctuation">.</span>offsetWidth <span class="token operator">-</span> inner<span class="token punctuation">.</span>offsetWidth<span class="token punctuation">;</span>

  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>outer<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> scrollbarWidth<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="pipe-promise"><a href="#pipe-promise" aria-hidden="true" class="header-anchor">#</a> pipe-promise</h3> <p>跟 compose 函数用法类似，只不过 compose 函数是从右到左执行，链式，按顺序调用 promise 函数</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">pipe</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">...</span>functions<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>input<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
  functions<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>chain<span class="token punctuation">,</span> func<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> chain<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">,</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="五月"><a href="#五月" aria-hidden="true" class="header-anchor">#</a> 五月</h2> <h3 id="iview-modal-组件-slot-重渲染"><a href="#iview-modal-组件-slot-重渲染" aria-hidden="true" class="header-anchor">#</a> iview Modal 组件 slot 重渲染</h3> <p>iview Modal 组件关闭后再打开内部插槽组件是不会重新渲染的，如果要重渲染，如何实现？下面是二次封装 Modal 组件解决方式的一些代码片段：</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Modal</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>show<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-bind</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>$attrs<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-on</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>$listeners<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>slotRerender<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>showSlot<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">v-else</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Modal</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript">
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  watch<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token keyword">async</span> <span class="token function">value</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">===</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>showSlot <span class="token operator">=</span> <span class="token operator">!</span>n<span class="token punctuation">;</span>
        <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>show <span class="token operator">=</span> n<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>showSlot <span class="token operator">=</span> n<span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>show <span class="token operator">=</span> n<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="如何用-this-xxx-方式挂载-vue-组件"><a href="#如何用-this-xxx-方式挂载-vue-组件" aria-hidden="true" class="header-anchor">#</a> 如何用 this.\$xxx 方式挂载 vue 组件</h3> <p>比如我这边有个基于 iview modal 封装的弹窗组件 ErsConfirm，用普通的模板写法就是这样的</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ErsConfirm</span>
  <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>modal1<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>删除<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">confirm-info</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>确定要删除该项目吗？<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">@on-confirm</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ok<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">@on-close</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>cancel<span class="token punctuation">&quot;</span></span>
<span class="token punctuation">/&gt;</span></span>
</code></pre></div><p>如果在业务逻辑中存在多个询问弹窗层，写大量模板是比较难受的事情，代码也比较冗余，所以需要用 js 命令式的方式进行组件挂载，这样看起来就优雅得多，下面是实现过程：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> ErsConfirm <span class="token keyword">from</span> <span class="token string">'./ErsConfirm/ErsConfirm.vue'</span><span class="token punctuation">;</span>

<span class="token comment">// Vue.use()</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Vue<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$ErsConfirm <span class="token operator">=</span> createErsConfirm<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">createErsConfirm</span><span class="token punctuation">(</span>options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> instance <span class="token operator">=</span> ErsConfirm<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
  instance<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 拿属性，不拿方法</span>
<span class="token keyword">function</span> <span class="token function">getAttrs</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>pre<span class="token punctuation">,</span> cur<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> props<span class="token punctuation">[</span>cur<span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      pre<span class="token punctuation">[</span>cur<span class="token punctuation">]</span> <span class="token operator">=</span> props<span class="token punctuation">[</span>cur<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> pre<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">noop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

ErsConfirm<span class="token punctuation">.</span><span class="token function-variable function">newInstance</span> <span class="token operator">=</span> <span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> onConfirm<span class="token punctuation">,</span> onClose <span class="token punctuation">}</span> <span class="token operator">=</span> props<span class="token punctuation">;</span>
  <span class="token keyword">const</span> attrs <span class="token operator">=</span> <span class="token function">getAttrs</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    inheritAttrs<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    data<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      visible<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token function">change</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">===</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$el<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$el<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>$el <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>ErsConfirm
          value<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>visible<span class="token punctuation">}</span>
          on<span class="token operator">-</span>input<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>change<span class="token punctuation">}</span>
          <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">{</span>
            attrs<span class="token punctuation">,</span>
            on<span class="token punctuation">:</span> <span class="token punctuation">{</span>
              <span class="token string">'on-confirm'</span><span class="token punctuation">:</span> onConfirm <span class="token operator">||</span> noop<span class="token punctuation">,</span>
              <span class="token string">'on-close'</span><span class="token punctuation">:</span> onClose <span class="token operator">||</span> noop<span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">}</span>
        <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> component <span class="token operator">=</span> instance<span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>component<span class="token punctuation">.</span>$el<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      instance<span class="token punctuation">.</span>visible <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>安装插件</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> $ErsConfirm <span class="token keyword">from</span> <span class="token string">'./$ErsConfirm'</span><span class="token punctuation">;</span>
Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>$ErsConfirm<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>这样，就可以用 this.\$ErsConfirm 方式来使用了该组件了</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$ErsConfirm</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  title<span class="token punctuation">:</span> <span class="token string">'删除'</span><span class="token punctuation">,</span>
  confirmInfo<span class="token punctuation">:</span> <span class="token string">'确定要删除该项目吗？'</span><span class="token punctuation">,</span>
  onConfirm<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'confirm'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  onClose<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'close'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="六月"><a href="#六月" aria-hidden="true" class="header-anchor">#</a> 六月</h2> <h3 id="typescript-中的元组"><a href="#typescript-中的元组" aria-hidden="true" class="header-anchor">#</a> typeScript 中的元组</h3> <p>元组即 h 为合并了多种类型的数组，用于定义具有有限数量的未命名属性的类型</p> <p>比如这么使用：</p> <div class="language-typeScript extra-class"><pre class="language-typescript"><code><span class="token keyword">const</span> tuple<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token builtin">number</span><span class="token punctuation">,</span> <span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">boolean</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><p>预先声明了什么类型，都需要提供对应的值</p> <h3 id="yarn-link-出现-permission-denied"><a href="#yarn-link-出现-permission-denied" aria-hidden="true" class="header-anchor">#</a> yarn link 出现 permission denied</h3> <p>在本地<code>mac</code>开发环境中，<code>yarn link</code>之后如果可能会遇到<code>permission denied</code>问题，可参考这个<a href="https://github.com/yarnpkg/yarn/issues/3587" target="_blank" rel="noopener noreferrer">issue<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>解决方法就是需要使用<code>chmod +x</code>+你的<code>bin</code>文件中的<code>index.js</code>开启可执行权限，例如你的文件在<code>xxx/cli/bin/index.js</code>中，则使用<code>chmod +x xxx/cli/bin/index.js</code>就可以了</p> <h3 id="object-is-polyfill"><a href="#object-is-polyfill" aria-hidden="true" class="header-anchor">#</a> Object.is polyfill</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Object<span class="token punctuation">.</span>is<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Object<span class="token punctuation">.</span><span class="token function-variable function">is</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// SameValue algorithm</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">===</span> y<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// Steps 1-5, 7-10</span>
      <span class="token comment">// Steps 6.b-6.e: +0 != -0</span>
      <span class="token keyword">return</span> x <span class="token operator">!==</span> <span class="token number">0</span> <span class="token operator">||</span> <span class="token number">1</span> <span class="token operator">/</span> x <span class="token operator">===</span> <span class="token number">1</span> <span class="token operator">/</span> y<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// Step 6.a: NaN == NaN</span>
      <span class="token keyword">return</span> x <span class="token operator">!==</span> x <span class="token operator">&amp;&amp;</span> y <span class="token operator">!==</span> y<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="yarn-link-之后可执行命令存在哪里"><a href="#yarn-link-之后可执行命令存在哪里" aria-hidden="true" class="header-anchor">#</a> yarn link 之后可执行命令存在哪里</h3> <p>存在了<code>/usr/local/bin</code>目录下</p> <h2 id="七月"><a href="#七月" aria-hidden="true" class="header-anchor">#</a> 七月</h2> <h3 id="转译函数"><a href="#转译函数" aria-hidden="true" class="header-anchor">#</a> 转译函数</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Security helper :)</span>
<span class="token keyword">function</span> <span class="token function">EscapeHtml</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> map <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'&amp;'</span><span class="token punctuation">:</span> <span class="token string">'&amp;amp;'</span><span class="token punctuation">,</span>
    <span class="token string">'&lt;'</span><span class="token punctuation">:</span> <span class="token string">'&amp;lt;'</span><span class="token punctuation">,</span>
    <span class="token string">'&gt;'</span><span class="token punctuation">:</span> <span class="token string">'&amp;gt;'</span><span class="token punctuation">,</span>
    <span class="token string">'&quot;'</span><span class="token punctuation">:</span> <span class="token string">'&amp;quot;'</span><span class="token punctuation">,</span>
    <span class="token string">&quot;'&quot;</span><span class="token punctuation">:</span> <span class="token string">'&amp;#039;'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> text<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/[&amp;&lt;&gt;&quot;']/g</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>m<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> map<span class="token punctuation">[</span>m<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="nodejs-一些路径变量"><a href="#nodejs-一些路径变量" aria-hidden="true" class="header-anchor">#</a> nodejs 一些路径变量</h3> <p>最近在写脚手架，记录些路径变量</p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 当前文件执行路径</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 当前程序运行路径，也就是在哪开始 node xxx 的</span>

<span class="token comment">// path.resolve() 方法可以将多个路径解析为一个规范化的绝对路径</span>
<span class="token comment">// path.join() 方法可以连接任意多个路径字符串</span>
<span class="token comment">// 注意，path这些api并不会使用文件系统来判断该路径合不合法，只是单纯的处理'./'和'/'</span>
</code></pre></div><h3 id="模块重定向"><a href="#模块重定向" aria-hidden="true" class="header-anchor">#</a> 模块重定向</h3> <p>如果我们想要在当前模块中，导出指定导入模块的默认导出（等于是创建了一个“重定向”）：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token constant">A</span> <span class="token keyword">from</span> &quot;<span class="token punctuation">.</span><span class="token operator">/</span><span class="token constant">A</span><span class="token punctuation">.</span>vue'<span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token constant">A</span><span class="token punctuation">;</span>

<span class="token comment">// 其实是可以用模块重定向简写的</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span> <span class="token keyword">default</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./A.vue&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// 如果模块有多个导出，可以这么做</span>
<span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">'./other-module'</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="ts-使用-fs-promises"><a href="#ts-使用-fs-promises" aria-hidden="true" class="header-anchor">#</a> ts 使用 fs.promises</h3> <p>使用 node 自带<code>fs.promises</code>模块，可以不需要<code>fs-extra</code>了</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> promises <span class="token keyword">as</span> fs <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'fs'</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="查看远程-npm-包最新版本"><a href="#查看远程-npm-包最新版本" aria-hidden="true" class="header-anchor">#</a> 查看远程 npm 包最新版本</h3> <p>最近脚手架做了个检测更新的功能，需要检测远程 npm 包的版本，和本地进行对比，获得 npm 包最新版本有以下几种方法：</p> <p>第一种，直接用 npm 自带脚本</p> <div class="language- extra-class"><pre class="language-text"><code>npm show xxx version
</code></pre></div><p>第二种，使用第三方库<a href="https://github.com/sindresorhus/latest-version#readme" target="_blank" rel="noopener noreferrer">latest-version<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>进行检测</p> <h3 id="docker-nginx-容器-hjson-中文乱码"><a href="#docker-nginx-容器-hjson-中文乱码" aria-hidden="true" class="header-anchor">#</a> docker nginx 容器 hjson 中文乱码</h3> <p>linux 下采用 utf-8 编码，默认情况下我们的浏览器在服务器没有指定编码或者静态页面没有声明编码的情况下会以 gbk 的编码去渲染页面，这样默认情况下返回中文的话浏览器用 gbk 来解析 utf-8 编码，会出现乱码，解决方法如下：</p> <p>在 server 配置中增加</p> <div class="language- extra-class"><pre class="language-text"><code>server {
  add_header Content-Type 'text/html; charset=utf-8';
}
</code></pre></div><p>这种主要是解决 network 中 previvew 中乱码，在页面上显示还是正常的，因为页面本来就指定了 utf-8 编码</p> <h3 id="获取项目部署路径"><a href="#获取项目部署路径" aria-hidden="true" class="header-anchor">#</a> 获取项目部署路径</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 默认获取第一层</span>
<span class="token comment">// 看&quot;/&quot;在哪，取到哪，从0开始数起</span>
<span class="token keyword">const</span> <span class="token function-variable function">getAbsolutePath</span> <span class="token operator">=</span> <span class="token punctuation">(</span>level <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> path <span class="token operator">=</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>pathname<span class="token punctuation">;</span>

  <span class="token keyword">let</span> numDirsProcessed <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> start <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>path<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> path<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>level <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">'/'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">while</span> <span class="token punctuation">(</span>numDirsProcessed <span class="token operator">!==</span> level<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> char <span class="token operator">=</span> path<span class="token punctuation">[</span><span class="token operator">++</span>start<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>char <span class="token operator">===</span> <span class="token string">'/'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      numDirsProcessed<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>char<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token string">'/'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> path<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> start <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">getDeployPath</span> <span class="token operator">=</span> <span class="token punctuation">(</span>level<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>origin <span class="token operator">+</span> <span class="token function">getAbsolutePath</span><span class="token punctuation">(</span>level<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="nodejs-判断文件或者目录是否存在的"><a href="#nodejs-判断文件或者目录是否存在的" aria-hidden="true" class="header-anchor">#</a> nodejs 判断文件或者目录是否存在的</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//</span>
<span class="token keyword">function</span> <span class="token function">pathExists</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> fs<span class="token punctuation">.</span>promises
    <span class="token punctuation">.</span><span class="token function">access</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="nodejs-集体导出模块的方法"><a href="#nodejs-集体导出模块的方法" aria-hidden="true" class="header-anchor">#</a> nodejs 集体导出模块的方法</h3> <p>合并到<code>exports</code>对象上即可，参考了<code>@vue/cli-shared-utils</code>源码</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">[</span>
  <span class="token string">'env'</span><span class="token punctuation">,</span>
  <span class="token string">'exit'</span><span class="token punctuation">,</span>
  <span class="token string">'ipc'</span><span class="token punctuation">,</span>
  <span class="token string">'logger'</span><span class="token punctuation">,</span>
  <span class="token string">'module'</span><span class="token punctuation">,</span>
  <span class="token string">'object'</span><span class="token punctuation">,</span>
  <span class="token string">'openBrowser'</span><span class="token punctuation">,</span>
  <span class="token string">'pkg'</span><span class="token punctuation">,</span>
  <span class="token string">'pluginResolution'</span><span class="token punctuation">,</span>
  <span class="token string">'launch'</span><span class="token punctuation">,</span>
  <span class="token string">'request'</span><span class="token punctuation">,</span>
  <span class="token string">'spinner'</span><span class="token punctuation">,</span>
  <span class="token string">'validate'</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`./lib/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>m<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="八月"><a href="#八月" aria-hidden="true" class="header-anchor">#</a> 八月</h2> <h3 id="docker-如何不使用缓存重建镜像"><a href="#docker-如何不使用缓存重建镜像" aria-hidden="true" class="header-anchor">#</a> docker 如何不使用缓存重建镜像</h3> <p>docker 在重建镜像的时候，会优先使用缓存进行构建，但是有些情况不能使用缓存构建，比如前端代码拉取打包这些，如何用了缓存生成代码就不能更新，所以需要解决这个问题</p> <p><code>docker build --no-cache .</code></p> <p>构建时带上<code>--no-cache</code>即可</p> <h3 id="判断空对象的方法"><a href="#判断空对象的方法" aria-hidden="true" class="header-anchor">#</a> 判断空对象的方法</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">checkObjectEmpty</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    value <span class="token operator">&amp;&amp;</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> value<span class="token punctuation">.</span>constructor <span class="token operator">===</span> Object
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>为什么要加<code>value.constructor === Object</code>的判断？</p> <p>如果不加，参数输入以下这几种均为<code>true</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">checkObjectEmpty</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token function">checkObjectEmpty</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token function">checkObjectEmpty</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Boolean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token function">checkObjectEmpty</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token function">checkObjectEmpty</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token function">checkObjectEmpty</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token function">checkObjectEmpty</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre></div><p>实际上，我们只检测<code>new Object()</code>而不包括上面这种构造函数的实例</p> <p>还有，增加 value 是否存在的判断，是为了过滤<code>null</code>和<code>undefined</code>，避免报 error</p> <h3 id="es6-判断-2-个对象是否相等"><a href="#es6-判断-2-个对象是否相等" aria-hidden="true" class="header-anchor">#</a> ES6 判断 2 个对象是否相等</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> o1 <span class="token operator">=</span> <span class="token punctuation">{</span> fruit<span class="token punctuation">:</span> <span class="token string">'apple'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> o2 <span class="token operator">=</span> <span class="token punctuation">{</span> fruit<span class="token punctuation">:</span> <span class="token string">'apple'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>o1<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>o2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre></div><h3 id="过滤对象某个-key-值"><a href="#过滤对象某个-key-值" aria-hidden="true" class="header-anchor">#</a> 过滤对象某个 key 值</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> food <span class="token operator">=</span> <span class="token punctuation">{</span> meat<span class="token punctuation">:</span> <span class="token string">'🥩'</span><span class="token punctuation">,</span> broccoli<span class="token punctuation">:</span> <span class="token string">'🥦'</span><span class="token punctuation">,</span> carrot<span class="token punctuation">:</span> <span class="token string">'🥕'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">filterObjectKey</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> k<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> Object<span class="token punctuation">.</span><span class="token function">fromEntries</span><span class="token punctuation">(</span>
    Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">[</span>key<span class="token punctuation">,</span> value<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> key <span class="token operator">!==</span> k<span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">filterObjectKey</span><span class="token punctuation">(</span>food<span class="token punctuation">,</span> <span class="token string">'meat'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// { broccoli: '🥦', carrot: '🥕' }</span>
</code></pre></div><h3 id="babel-是怎么实现-const-和-let-块级作用域的"><a href="#babel-是怎么实现-const-和-let-块级作用域的" aria-hidden="true" class="header-anchor">#</a> babel 是怎么实现 const 和 let 块级作用域的</h3> <p>在 ES6 中，const 和 let 声明变量只会在代码块中有效，但是在 ES5 中是没有的，那 babel 是怎么实现的呢？</p> <p>其实 babel 是通过编译时实现的，而非运行时实现，比如：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> content <span class="token operator">=</span> <span class="token template-string"><span class="token string">``</span></span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>编译后：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> _content <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>_content<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>可以看到，块级内的<code>content</code>变量被编译成<code>_content</code>，块级外面的<code>content</code>则没被编译，这样就实现了块级作用域化</p> <p>那老生常谈的 for 循环中的 let 块级作用域的实现呢，因为单纯靠改变变量名是实现不了的，比如<code>for (var i = 0; i &lt; 10; i++)</code>和<code>for (var _i = 0; _i &lt; 10; _i++)</code>是一样的，babel 的实现是这样的：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>编译后：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> <span class="token function-variable function">_loop</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">_loop</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">_loop</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>可以看到，babel 的实现方式是增加一个<code>_loop</code>函数，每次循环都执行一次<code>_loop</code>函数，把变量保存在<strong>闭包</strong>里面，这样读取的就不是全局变量 i 了</p> <h3 id="ts-get-函数正确写法"><a href="#ts-get-函数正确写法" aria-hidden="true" class="header-anchor">#</a> ts get 函数正确写法</h3> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'obj'</span><span class="token punctuation">,</span>
  value<span class="token punctuation">:</span> <span class="token number">666</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token keyword">get</span><span class="token punctuation">(</span>obj<span class="token punctuation">:</span> object<span class="token punctuation">,</span> key<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这种写法是有问题的，ts 无法推断返回值的类型，也无法对 key 值进行约束</p> <p>正确的写法，关键在于<code>keyof</code>的使用</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">function</span> <span class="token keyword">get</span><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name">object</span><span class="token punctuation">,</span> <span class="token constant">K</span> <span class="token keyword">extends</span> <span class="token class-name">keyof</span> <span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>obj<span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">,</span> key<span class="token punctuation">:</span> <span class="token constant">K</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">K</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="nodejs-拉取远端图片保存本地基础写法"><a href="#nodejs-拉取远端图片保存本地基础写法" aria-hidden="true" class="header-anchor">#</a> nodejs 拉取远端图片保存本地基础写法</h3> <p><code>http</code>模块请求方式</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">fetchFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  http<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`xxx.jpg`</span></span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>stream<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> chunks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    stream<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>chunk<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      chunks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>chunk<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    stream<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>chunk<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      res <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>chunks<span class="token punctuation">)</span><span class="token punctuation">;</span>

      fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span><span class="token string">'xxx.jpg'</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>axios</code>请求方式</p> <div class="language-js extra-class"><pre class="language-js"><code>axios
  <span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`xxx.jpg`</span></span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token comment">// 注重要指定 responseType 为 &quot;arraybuffer&quot;</span>
    <span class="token comment">// 不然默认返回的是Buffer.toString()</span>
    <span class="token comment">// 这样保存图片就会有问题</span>
    responseType<span class="token punctuation">:</span> <span class="token string">'arraybuffer'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span><span class="token string">'xxx.jpg'</span><span class="token punctuation">,</span> res<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><code>axios</code>源码写法如下</p> <div class="language-js extra-class"><pre class="language-js"><code>stream<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">handleStreamEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> responseData <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>responseBuffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>config<span class="token punctuation">.</span>responseType <span class="token operator">!==</span> <span class="token string">'arraybuffer'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    responseData <span class="token operator">=</span> responseData<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>responseEncoding<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  response<span class="token punctuation">.</span>data <span class="token operator">=</span> responseData<span class="token punctuation">;</span>
  <span class="token function">settle</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>所以使用<code>axios</code>请求图片流时需要声明<code>responseType</code>为<code>&quot;arraybuffer&quot;</code></p> <h2 id="九月"><a href="#九月" aria-hidden="true" class="header-anchor">#</a> 九月</h2> <h3 id="浏览器如何检测系统主题色"><a href="#浏览器如何检测系统主题色" aria-hidden="true" class="header-anchor">#</a> 浏览器如何检测系统主题色</h3> <p>在较新的浏览器中，可以使用<code>prefers-color-scheme</code>CSS 媒体查询来检测系统主题色为<code>light</code>或者是<code>dark</code></p> <div class="language-css extra-class"><pre class="language-css"><code><span class="token atrule"><span class="token rule">@media</span> <span class="token punctuation">(</span><span class="token property">prefers-color-scheme</span><span class="token punctuation">:</span> dark<span class="token punctuation">)</span></span> <span class="token punctuation">{</span>
  <span class="token selector">.day.dark-scheme</span> <span class="token punctuation">{</span>
    <span class="token property">background</span><span class="token punctuation">:</span> #333<span class="token punctuation">;</span>
    <span class="token property">color</span><span class="token punctuation">:</span> white<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token selector">.night.dark-scheme</span> <span class="token punctuation">{</span>
    <span class="token property">background</span><span class="token punctuation">:</span> black<span class="token punctuation">;</span>
    <span class="token property">color</span><span class="token punctuation">:</span> #ddd<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token atrule"><span class="token rule">@media</span> <span class="token punctuation">(</span><span class="token property">prefers-color-scheme</span><span class="token punctuation">:</span> light<span class="token punctuation">)</span></span> <span class="token punctuation">{</span>
  <span class="token selector">.day.light-scheme</span> <span class="token punctuation">{</span>
    <span class="token property">background</span><span class="token punctuation">:</span> white<span class="token punctuation">;</span>
    <span class="token property">color</span><span class="token punctuation">:</span> #555<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token selector">.night.light-scheme</span> <span class="token punctuation">{</span>
    <span class="token property">background</span><span class="token punctuation">:</span> #eee<span class="token punctuation">;</span>
    <span class="token property">color</span><span class="token punctuation">:</span> black<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>那在<code>js</code>中如何检测呢？还是有方法的，使用<code>window.matchMedia</code>来检测</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> darkMode <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">matchMedia</span><span class="token punctuation">(</span><span class="token string">'(prefers-color-scheme: dark)'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> lightMode <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">matchMedia</span><span class="token punctuation">(</span><span class="token string">'(prefers-color-scheme: light)'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>darkMode<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>lightMode<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="前端如何下载-base64-字符串图片"><a href="#前端如何下载-base64-字符串图片" aria-hidden="true" class="header-anchor">#</a> 前端如何下载 base64 字符串图片</h3> <p>前端想下载图片，如果后端返回了<code>base64</code>字符，没有返回文件流的话，改如何实现下载？</p> <p>首先要把 base64 字符串转 blob</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">base64ToBlob</span><span class="token punctuation">(</span>base64<span class="token punctuation">,</span> type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> byteCharacters <span class="token operator">=</span> <span class="token function">atob</span><span class="token punctuation">(</span>base64<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 解码</span>
  <span class="token keyword">const</span> byteNumbers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span>byteCharacters<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> byteCharacters<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    byteNumbers<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> byteCharacters<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> buffer <span class="token operator">=</span> Uint8Array<span class="token punctuation">.</span><span class="token keyword">from</span><span class="token punctuation">(</span>byteNumbers<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> blob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span>buffer<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> type <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> blob<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>然后再把<code>blob</code>转成<code>blob:URL</code>, a 标签下载<code>blob:URL</code>即可</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">downloadBlob</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> aTag <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  aTag<span class="token punctuation">.</span>download <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> blobUrl <span class="token operator">=</span> <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span><span class="token punctuation">;</span>
  aTag<span class="token punctuation">.</span>href <span class="token operator">=</span> blobUrl<span class="token punctuation">;</span>
  aTag<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">revokeObjectURL</span><span class="token punctuation">(</span>blobUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="生成区间的随机数"><a href="#生成区间的随机数" aria-hidden="true" class="header-anchor">#</a> 生成区间的随机数</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">getRandomIntInclusive</span><span class="token punctuation">(</span>min<span class="token punctuation">,</span> max<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  min <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span>min<span class="token punctuation">)</span><span class="token punctuation">;</span>
  max <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>max<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>max <span class="token operator">-</span> min <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> min<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="chrome-开启-pause-on-exceptions"><a href="#chrome-开启-pause-on-exceptions" aria-hidden="true" class="header-anchor">#</a> chrome 开启 pause on exceptions</h3> <p>在<code>sources</code>面板中可以开启<code>pause on exceptions</code>功能，这个功能可以在代码出现异常的自动打上断点，可以很方便的排查未捕获错误发生的位置。</p> <h2 id="十月"><a href="#十月" aria-hidden="true" class="header-anchor">#</a> 十月</h2> <h3 id="查看项目-node-modules-文件夹大小"><a href="#查看项目-node-modules-文件夹大小" aria-hidden="true" class="header-anchor">#</a> 查看项目 node_modules 文件夹大小</h3> <p>unix 和 linux 系统使用<code>du -hd 0 node_modules</code>即可</p> <p><code>du -hd 1 node_modules</code>可以查看里面每个文件夹的文件大小</p> <h3 id="vue-devtool-无法显示使用-mount-动态挂载的组件解决方法"><a href="#vue-devtool-无法显示使用-mount-动态挂载的组件解决方法" aria-hidden="true" class="header-anchor">#</a> vue-devtool 无法显示使用 <code>$mount</code> 动态挂载的组件解决方法</h3> <p>类似这种情况</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>component<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript">
  <span class="token keyword">const</span> root <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> MyComponent <span class="token operator">=</span> Vue<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'component'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">new</span> <span class="token class-name">MyComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token string">'#component'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 动态挂载组件</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>可以看到 id 为<code>component</code>的组件是动态挂载上去的，这种情况在<strong>vue-devtool</strong>中无法显示这个子组件，只会显示<code>root</code>组件，为什么呢？主要是动态挂载的组件和 root 组件没有形成父子关系，因为 vue 已经初始化完成，所以需要手动声明下他们的父子关系，解决方法如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> MyComponent <span class="token operator">=</span> Vue<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'component'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">new</span> <span class="token class-name">MyComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  parent<span class="token punctuation">:</span> root<span class="token punctuation">,</span> <span class="token comment">// 声明父子关系</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token string">'#component'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 或者用这种方法也行</span>
MyComponent<span class="token punctuation">.</span>$parent <span class="token operator">=</span> root<span class="token punctuation">;</span>
root<span class="token punctuation">.</span>$children<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>MyComponent<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="本地图片预览"><a href="#本地图片预览" aria-hidden="true" class="header-anchor">#</a> 本地图片预览</h3> <p>本地图片预览，在 type 为 file 的 input 标签上传触发 onchange 事件发生后，使用 FileReader 即可实现</p> <p>一种是使用<code>data:URL</code>base64 展示，不过这种长度浏览器有限制</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
reader<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> output <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#preview'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  output<span class="token punctuation">.</span>src <span class="token operator">=</span> reader<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
reader<span class="token punctuation">.</span><span class="token function">readAsDataURL</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>另一种是使用<code>blob:URL</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
reader<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> output <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#preview'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> blob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span>reader<span class="token punctuation">.</span>result<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">'image/png'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> blobUrl <span class="token operator">=</span> <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span><span class="token punctuation">;</span>
  output<span class="token punctuation">.</span>src <span class="token operator">=</span> blobUrl<span class="token punctuation">;</span>
  <span class="token function">queueMicrotask</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">revokeObjectURL</span><span class="token punctuation">(</span>blobUrl<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 异步 revoke</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
reader<span class="token punctuation">.</span><span class="token function">readAsArrayBuffer</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="nginx-开启负载均衡"><a href="#nginx-开启负载均衡" aria-hidden="true" class="header-anchor">#</a> nginx 开启负载均衡</h3> <p>使用<code>proxy_pass</code>和<code>upstream</code>可以开启负载均衡</p> <div class="language- extra-class"><pre class="language-text"><code>http {
  upstream site {
    server 192.168.0.1;
    server 192.168.0.2;
    server 192.168.0.3;
  }

  server {
    listen 80;
    location / {
      proxy_pass http://site;
    }
  }
}
</code></pre></div><p>负载均衡有 4 种模式</p> <ul><li>轮询</li></ul> <p>默认使用的方式，按服务器配置节点顺序轮询</p> <ul><li>加权轮询</li></ul> <div class="language- extra-class"><pre class="language-text"><code>upstream site {
  server 192.168.0.1 weight=1;
  server 192.168.0.2 weight=2;
  server 192.168.0.3 weight=3;
}
</code></pre></div><ul><li>ip_hash</li></ul> <p>对 ip 地址进行 hash，这样用户就会在固定的服务器上请求，利于缓存和进行接口测试</p> <div class="language- extra-class"><pre class="language-text"><code>upstream site {
  server 192.168.0.1;
  server 192.168.0.2;
  server 192.168.0.3;
  ip_hash;
}
</code></pre></div><ul><li>least_conn;</li></ul> <p>优先选择连接数量最少的服务器负载</p> <div class="language- extra-class"><pre class="language-text"><code>upstream site {
  server 192.168.0.1;
  server 192.168.0.2;
  server 192.168.0.3;
  least_conn;
}
</code></pre></div><h3 id="一行代码实现评分组件"><a href="#一行代码实现评分组件" aria-hidden="true" class="header-anchor">#</a> 一行代码实现评分组件</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">genRate</span><span class="token punctuation">(</span>rate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token string">'★★★★★☆☆☆☆☆'</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">5</span> <span class="token operator">-</span> rate<span class="token punctuation">,</span> <span class="token number">10</span> <span class="token operator">-</span> rate<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="十一月"><a href="#十一月" aria-hidden="true" class="header-anchor">#</a> 十一月</h2> <h3 id="nodejs-一些路径常识"><a href="#nodejs-一些路径常识" aria-hidden="true" class="header-anchor">#</a> nodejs 一些路径常识</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 当前文件执行路径</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 当前程序运行路径，也就是在哪开始 node xxx 的</span>

<span class="token comment">// path.resolve()方法可以将多个路径解析为一个规范化的绝对路径</span>
<span class="token comment">// path.join()方法可以连接任意多个路径字符串</span>

<span class="token keyword">const</span> path1 <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'/a/b'</span><span class="token punctuation">,</span> <span class="token string">'/c/d'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>path1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// /c/d</span>

<span class="token keyword">const</span> path2 <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'/a/b'</span><span class="token punctuation">,</span> <span class="token string">'/c/d'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>path2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// /a/b/c/d</span>
</code></pre></div><h3 id="在-node-中不能使用exports-xxx的原因"><a href="#在-node-中不能使用exports-xxx的原因" aria-hidden="true" class="header-anchor">#</a> 在 node 中不能使用<code>exports=xxx</code>的原因</h3> <p>在编译过程中，node 对获取的 javaScript 文件内容进行了头尾包装</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> require<span class="token punctuation">,</span> module<span class="token punctuation">,</span> __filename<span class="token punctuation">,</span> __dirname<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// exports其实是module.exports的一个引用，如果你直接对exports进行赋值，那module.exports的值是不会改变的</span>
  <span class="token comment">// 最终导出的也是module.exports的值</span>
  <span class="token comment">// 所以尽量使用 module.exports = xxx</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>module<span class="token punctuation">.</span>exports<span class="token punctuation">,</span> require<span class="token punctuation">,</span> module<span class="token punctuation">,</span> __filename<span class="token punctuation">,</span> __dirname<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">return</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">;</span>
</code></pre></div><h3 id="isnan-和-number-isnan-的区别"><a href="#isnan-和-number-isnan-的区别" aria-hidden="true" class="header-anchor">#</a> isNaN 和 Number.isNaN 的区别</h3> <p>isNaN会把参数转为数值，任何不能被转换为数值的值都会返回true，所以非数字值传入会返回，不过</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">isNaN</span><span class="token punctuation">(</span>undefined<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
</code></pre></div><p>这是因为<code>Number(undefined)</code>的值为<code>NaN</code></p> <p>所以，这会影响 NaN 的判断</p> <p><code>Number.isNaN</code>会先判断传入的值是不是数字，是数字再进行<code>NaN</code>判断</p> <div class="language-js extra-class"><pre class="language-js"><code>Number<span class="token punctuation">.</span>isNaN <span class="token operator">=</span> Number<span class="token punctuation">.</span>isNaN <span class="token operator">||</span> <span class="token keyword">function</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">typeof</span> value <span class="token operator">===</span> <span class="token string">'number'</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isNaN</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>所以使用<code>Number.isNaN</code>判断<code>NaN</code>更为准确</p> <h3 id="chrome-devtool-network-请求时序信息"><a href="#chrome-devtool-network-请求时序信息" aria-hidden="true" class="header-anchor">#</a> chrome devtool network 请求时序信息</h3> <ul><li>Queueing: 浏览器在以下情况下将请求排队：
有更高优先级的请求。
已为该来源打开了六个TCP连接，这是限制。仅适用于HTTP / 1.0和HTTP / 1.1。
浏览器正在磁盘缓存中短暂分配空间</li> <li>Stalled: 从TCP连接建立完成，到真正可以传输数据之间的时间差，此时间包括代理协商时间</li> <li>DNS Lookup: 浏览器解析请求IP地址时间，也就是DNS查找时间</li> <li>Initial connection: 浏览器进行TCP握手/重试/协商SSL花费的时间</li> <li>Proxy negotiation: 浏览器与代理服务器协商请求的时间</li> <li>Request sent: 正在发送请求</li> <li>ServiceWorker Preparation: 准备ServiceWorker</li> <li>Request to ServiceWorker: 向ServiceWorker发送请求</li> <li>Waiting (TTFB): 发送请求到接收到响应第一个字节的时间总和。TTFB代表到第一个字节的时间。包含一次往返延迟和服务器准备响应所花费的时间</li> <li>Content Download: 接收响应数据所花费的时间</li> <li>Receiving Push: 浏览器正在通过HTTP/2服务器推送接收此响应的数据</li> <li>Reading Push: 浏览器正在读取先前接收的本地数据</li></ul> <h3 id="关于vue的key几个问题讨论"><a href="#关于vue的key几个问题讨论" aria-hidden="true" class="header-anchor">#</a> 关于vue的key几个问题讨论</h3> <ul><li>为什么v-for要加key？</li></ul> <p>答：为了复用旧节点vnode，避免组件的重新创建和销毁，提高性能。因为判断是否为同个节点sameVnode函数，有一项是根据key来进行判断的，如果没有key，那就等于全部组件节点都要重新创建和销毁，如果提供了key，新旧节点是一样，最多就移动下位置就可以了。</p> <ul><li>为什么不要用索引index、随机数当key？</li></ul> <p>答：同样是无法达到性能上的优化，有几种情况，分点讨论</p> <p>1、如果渲染数组的顺序翻转，index值虽然不会变，节点内容改变了，如果是纯标签<code>&lt;li&gt;</code>这些，vue就直接改变元素内容，但是，如果是组件，有props的情况下，diff过程会发现props的改变，然后触发组件的视图重新渲染，必然会导致dom的操作。</p> <p>2、如果是在数组<code>[1,2,3]</code>中插入一个值，变成<code>[1,4,2,3]</code>，那么之前<code>2,3</code>组件的索引(key)由<code>1,2</code>变成<code>2,3</code>，key变了，sameVnode肯定为false，本来只需要新建1个组件，现在变成要新建3个，更新成本增加。</p> <p>3、看看这种情况</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>(val, idx) in arr<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>idx<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>comp</span> <span class="token attr-name">:val</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>idx<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>test<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>测试<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript">
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  el<span class="token punctuation">:</span> <span class="token string">'#app'</span><span class="token punctuation">,</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
   arr<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span>
  	<span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
   <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>arr<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  components<span class="token punctuation">:</span> <span class="token punctuation">{</span>
   comp<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    props<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'val'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    template<span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`&lt;span&gt;{{val}}&lt;/span&gt;`</span></span>
   <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>如果是数组<code>[1,2,3]</code>，使用<code>splice(0,1)</code>删除第一个节点，之前节点索引key为<code>[1,2,3] -&gt; 0,1,2</code>，现在变成<code>[2,3] -&gt; 0,1</code>，经过vue的比较逻辑，因为key都有<code>0,1</code>，所以vue会认为前面2个节点都没变，变得是少了key为2的节点，也就是最后一个，所以前面2个节点直接复用，在视图中你会发现vue就把最后一个节点给删了。</p> <p>但是，如果你直接使用<code>&lt;li v-for=&quot;(val, idx) in arr&quot; :key=&quot;idx&quot;&gt;&lt;/li&gt;</code>，你会察觉不到是删了最后一个节点，因为vue在diff过程中，发现了<code>li</code>是文本节点，在<code>patchVnode</code>函数有段逻辑</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>oldVnode<span class="token punctuation">.</span>text <span class="token operator">!==</span> vnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span> <span class="token punctuation">{</span>
 nodeOps<span class="token punctuation">.</span><span class="token function">setTextContent</span><span class="token punctuation">(</span>elm<span class="token punctuation">,</span> vnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>[1,2,3] -&gt; [2,3]</code>，数组文本改变，直接更新dom，所以你无法察觉，但是底层是删除了最后一个元素，所以啊，还是给一个稳定的id做key吧~</p> <ul><li>key用随机数的情况</li></ul> <p>key用随机数的话，这样新旧vnode的key全都不一样，很尴尬，vue直接判断全都不是sameVnode，全部重头再来~</p> <h3 id="vue-diff算法相关分析"><a href="#vue-diff算法相关分析" aria-hidden="true" class="header-anchor">#</a> vue diff算法相关分析</h3> <p>源码<code>core/vdom/patch.js</code></p> <p>为什么要diff？</p> <p>减少dom的更新量，找到最小差异部分的dom，也就是尽可能的复用旧节点，最后只更新新的部分即可，节省dom的新增和删除等操作</p> <p>新旧节点比较流程：</p> <p>前置条件为sameVnode，则新旧节点相同，然后再去diff它们的子节点</p> <p>如何判断相同节点？</p> <p>源码是这样子的</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">sameVnode</span> <span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    a<span class="token punctuation">.</span>key <span class="token operator">===</span> b<span class="token punctuation">.</span>key <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>
      <span class="token punctuation">(</span>
        a<span class="token punctuation">.</span>tag <span class="token operator">===</span> b<span class="token punctuation">.</span>tag <span class="token operator">&amp;&amp;</span>
        a<span class="token punctuation">.</span>isComment <span class="token operator">===</span> b<span class="token punctuation">.</span>isComment <span class="token operator">&amp;&amp;</span>
        <span class="token function">isDef</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token function">isDef</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
        <span class="token function">sameInputType</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span>
      <span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>
        <span class="token function">isTrue</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>isAsyncPlaceholder<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
        a<span class="token punctuation">.</span>asyncFactory <span class="token operator">===</span> b<span class="token punctuation">.</span>asyncFactory <span class="token operator">&amp;&amp;</span>
        <span class="token function">isUndef</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>asyncFactory<span class="token punctuation">.</span>error<span class="token punctuation">)</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>原理主要是判断vnode的<code>key</code>、<code>tag</code>、<code>是否是注释节点</code>、<code>是否有data</code>、<code>是否为相同的input type</code></p> <p>接着，看看patch函数，也就是<code>Vue.prototype.__patch__</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">patch</span> <span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> hydrating<span class="token punctuation">,</span> removeOnly<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isUndef</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token function">invokeDestroyHook</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">)</span>
      <span class="token keyword">return</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">let</span> isInitialPatch <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token keyword">const</span> insertedVnodeQueue <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

    <span class="token comment">// 如果没有旧节点，直接生成新节点</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isUndef</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// empty mount (likely as component), create new root element</span>
      isInitialPatch <span class="token operator">=</span> <span class="token boolean">true</span>
      <span class="token function">createElm</span><span class="token punctuation">(</span>vnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> isRealElement <span class="token operator">=</span> <span class="token function">isDef</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">.</span>nodeType<span class="token punctuation">)</span>
      <span class="token comment">// 如果是一样的vnode，则比较存在的根节点</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isRealElement <span class="token operator">&amp;&amp;</span> <span class="token function">sameVnode</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// patch existing root node</span>
        <span class="token function">patchVnode</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> removeOnly<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>isRealElement<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// mounting to a real element</span>
          <span class="token comment">// check if this is server-rendered content and if we can perform</span>
          <span class="token comment">// a successful hydration.</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>oldVnode<span class="token punctuation">.</span>nodeType <span class="token operator">===</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> oldVnode<span class="token punctuation">.</span><span class="token function">hasAttribute</span><span class="token punctuation">(</span><span class="token constant">SSR_ATTR</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            oldVnode<span class="token punctuation">.</span><span class="token function">removeAttribute</span><span class="token punctuation">(</span><span class="token constant">SSR_ATTR</span><span class="token punctuation">)</span>
            hydrating <span class="token operator">=</span> <span class="token boolean">true</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isTrue</span><span class="token punctuation">(</span>hydrating<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">hydrate</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token function">invokeInsertHook</span><span class="token punctuation">(</span>vnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
              <span class="token keyword">return</span> oldVnode
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token function">warn</span><span class="token punctuation">(</span>
                <span class="token string">'The client-side rendered virtual DOM tree is not matching '</span> <span class="token operator">+</span>
                <span class="token string">'server-rendered content. This is likely caused by incorrect '</span> <span class="token operator">+</span>
                <span class="token string">'HTML markup, for example nesting block-level elements inside '</span> <span class="token operator">+</span>
                <span class="token string">'&lt;p&gt;, or missing &lt;tbody&gt;. Bailing hydration and performing '</span> <span class="token operator">+</span>
                <span class="token string">'full client-side render.'</span>
              <span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
          <span class="token comment">// either not server-rendered, or hydration failed.</span>
          <span class="token comment">// create an empty node and replace it</span>
          oldVnode <span class="token operator">=</span> <span class="token function">emptyNodeAt</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// replacing existing element</span>
        <span class="token keyword">const</span> oldElm <span class="token operator">=</span> oldVnode<span class="token punctuation">.</span>elm
        <span class="token keyword">const</span> parentElm <span class="token operator">=</span> nodeOps<span class="token punctuation">.</span><span class="token function">parentNode</span><span class="token punctuation">(</span>oldElm<span class="token punctuation">)</span>

        <span class="token comment">// create new node</span>
        <span class="token comment">// 创建新节点</span>
        <span class="token function">createElm</span><span class="token punctuation">(</span>
          vnode<span class="token punctuation">,</span>
          insertedVnodeQueue<span class="token punctuation">,</span>
          <span class="token comment">// extremely rare edge case: do not insert if old element is in a</span>
          <span class="token comment">// leaving transition. Only happens when combining transition +</span>
          <span class="token comment">// keep-alive + HOCs. (#4590)</span>
          oldElm<span class="token punctuation">.</span>_leaveCb <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token punctuation">:</span> parentElm<span class="token punctuation">,</span>
          nodeOps<span class="token punctuation">.</span><span class="token function">nextSibling</span><span class="token punctuation">(</span>oldElm<span class="token punctuation">)</span>
        <span class="token punctuation">)</span>

        <span class="token comment">// update parent placeholder node element, recursively</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>parent<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">let</span> ancestor <span class="token operator">=</span> vnode<span class="token punctuation">.</span>parent
          <span class="token keyword">const</span> patchable <span class="token operator">=</span> <span class="token function">isPatchable</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span>
          <span class="token keyword">while</span> <span class="token punctuation">(</span>ancestor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> cbs<span class="token punctuation">.</span>destroy<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              cbs<span class="token punctuation">.</span>destroy<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span>ancestor<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            ancestor<span class="token punctuation">.</span>elm <span class="token operator">=</span> vnode<span class="token punctuation">.</span>elm
            <span class="token keyword">if</span> <span class="token punctuation">(</span>patchable<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> cbs<span class="token punctuation">.</span>create<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                cbs<span class="token punctuation">.</span>create<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span>emptyNode<span class="token punctuation">,</span> ancestor<span class="token punctuation">)</span>
              <span class="token punctuation">}</span>
              <span class="token comment">// #6513</span>
              <span class="token comment">// invoke insert hooks that may have been merged by create hooks.</span>
              <span class="token comment">// e.g. for directives that uses the &quot;inserted&quot; hook.</span>
              <span class="token keyword">const</span> insert <span class="token operator">=</span> ancestor<span class="token punctuation">.</span>data<span class="token punctuation">.</span>hook<span class="token punctuation">.</span>insert
              <span class="token keyword">if</span> <span class="token punctuation">(</span>insert<span class="token punctuation">.</span>merged<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// start at index 1 to avoid re-invoking component mounted hook</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> insert<span class="token punctuation">.</span>fns<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  insert<span class="token punctuation">.</span>fns<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
              <span class="token function">registerRef</span><span class="token punctuation">(</span>ancestor<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            ancestor <span class="token operator">=</span> ancestor<span class="token punctuation">.</span>parent
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// destroy old node</span>
        <span class="token comment">// 销毁旧节点</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>parentElm<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">removeVnodes</span><span class="token punctuation">(</span><span class="token punctuation">[</span>oldVnode<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">.</span>tag<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">invokeDestroyHook</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token function">invokeInsertHook</span><span class="token punctuation">(</span>vnode<span class="token punctuation">,</span> insertedVnodeQueue<span class="token punctuation">,</span> isInitialPatch<span class="token punctuation">)</span>
    <span class="token comment">// vm.$el</span>
    <span class="token keyword">return</span> vnode<span class="token punctuation">.</span>elm
  <span class="token punctuation">}</span>
</code></pre></div><p>源码太长，精简一下</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">patch</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>oldVnode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">createElm</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">sameVnode</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">patchVnode</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">createElm</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">removeVnodes</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token keyword">return</span> vnode<span class="token punctuation">.</span>elm<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>patch函数其实就是分为三个流程</p> <p>1、没有旧节点，直接全部新建</p> <p>2、旧节点和新节点自身一样，则去比较它们的子节点</p> <p>3、旧节点和新节点不一样，则创建新节点，删除旧节点</p> <p>第二个流程中，子节点的diff（新旧节点必须是sameVnode）</p> <p>比较新旧节点的子节点，核心就是<code>updateChildren</code>函数，循环对比</p> <p>简单概况就是：</p> <p>1、先找到不需要移动的相同节点（新头旧头、新尾旧尾判断），消耗最小</p> <p>2、再找相同但是需要移动的节点（新头旧尾、新尾旧头、单个查找），消耗第二小</p> <p>3、最后找不到，才会去新建删除节点，保底处理</p> <p>再细说下：</p> <p>1、旧头和新头比较，如果一样则不移动</p> <p>2、旧尾和旧尾比较，如果一样则不移动</p> <p>3、旧头和新尾比较，如果一样则操作dom，把旧头移动到尾部</p> <p>4、旧尾和新头比较，如果一样则操作dom，把旧尾移动到头部</p> <p>5、拿新节点去旧子节点数组中遍历，存在且sameNode为true就移动旧节点，不存在就新建节点</p> <p>6、如果新子节点遍历完了，旧子节点有剩余，让dom逐个删除旧节点</p> <p>7、如果旧子节点遍历完了，新子节点有剩余，全部新建子节点</p> <p>这样diff的原因，就是为了更高效找到和新节点一样的旧节点，然后只需要移动位置就可以了，避免了重新创建/删除dom</p> <h2 id="十二月"><a href="#十二月" aria-hidden="true" class="header-anchor">#</a> 十二月</h2> <h3 id="base64是什么？"><a href="#base64是什么？" aria-hidden="true" class="header-anchor">#</a> base64是什么？</h3> <p>Base64是一种基于64个可打印字符来表示二进制数据的表示方法。由于<code>log264 = 6</code>，所以每6个比特位元为一个单元，对应某个可打印字符。1个字节等于8比特位，3个字节相当于24个比特位，对应于4个Base64单元，即3个字节可由4个可打印字符来表示。</p> <h3 id="异步模块打包执行流程"><a href="#异步模块打包执行流程" aria-hidden="true" class="header-anchor">#</a> 异步模块打包执行流程</h3> <p>当一个文件被异步加载，在<code>index.js</code>中这么写</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span><span class="token punctuation">(</span><span class="token comment">/*webpackChunkName: &quot;async&quot;*/</span><span class="token string">'./async'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>被webpack处理过后index.js的样子，剔除引导模板runtime</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">(</span>window<span class="token punctuation">[</span><span class="token string">&quot;webpackJsonp&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> window<span class="token punctuation">[</span><span class="token string">&quot;webpackJsonp&quot;</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">&quot;app&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">{</span>

<span class="token comment">/***/</span> <span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">:</span>
<span class="token comment">/*!**********************!*\
  !*** ./src/index.js ***!
  \**********************/</span>
<span class="token comment">/*! no static exports found */</span>
<span class="token comment">/***/</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> __webpack_require__<span class="token punctuation">)</span> <span class="token punctuation">{</span>

__webpack_require__<span class="token punctuation">.</span><span class="token function">e</span><span class="token punctuation">(</span><span class="token comment">/*! import() | async */</span> <span class="token string">&quot;async&quot;</span><span class="token punctuation">)</span>
  <span class="token comment">// 需要被__webpack_require__加载</span>
  <span class="token comment">// __webpack_require__ 返回 module.exports</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>__webpack_require__<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">/*! ./async */</span> <span class="token string">&quot;./src/async.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  	res<span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">/***/</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;runtime&quot;</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>出现2个关键字，一个<code>webpackJsonp</code>，一个<code>__webpack_require__.e</code></p> <p><code>webpackJson.push</code>其实已经被重写了，并不是<code>Array.prototype.push</code>，而是一个函数，叫<code>webpackJsonpCallback</code>，为什么叫<code>jsonpCallbak</code>?其实很好理解，异步的chunk是通过script标签加载的，跟jsonp原理一样。当异步chunk下载完后，首先就是执行这个<code>webpackJsonpCallback</code>函数，看看这个函数</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/******/</span> 	<span class="token keyword">function</span> <span class="token function">webpackJsonpCallback</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 异步加载的文件中存放的需要安装的模块对应的 Chunk ID</span>
<span class="token comment">/******/</span> 		<span class="token keyword">var</span> chunkIds <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token comment">// 异步加载的文件中存放的需要安装的模块列表</span>
<span class="token comment">/******/</span> 		<span class="token keyword">var</span> moreModules <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token comment">// 在异步加载的文件中存放的需要安装的模块都安装成功后，需要执行的模块对应的 index</span>
  					<span class="token comment">// 比如 app.js 就是需要最开始执行的</span>
<span class="token comment">/******/</span> 		<span class="token keyword">var</span> executeModules <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">/******/</span>
<span class="token comment">/******/</span> 		<span class="token comment">// add &quot;moreModules&quot; to the modules object,</span>
<span class="token comment">/******/</span> 		<span class="token comment">// then flag all &quot;chunkIds&quot; as loaded and fire callback</span>
<span class="token comment">/******/</span> 		<span class="token keyword">var</span> moduleId<span class="token punctuation">,</span> chunkId<span class="token punctuation">,</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> resolves <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">/******/</span> 		<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> chunkIds<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">/******/</span> 			chunkId <span class="token operator">=</span> chunkIds<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">/******/</span> 			<span class="token keyword">if</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>hasOwnProperty<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>installedChunks<span class="token punctuation">,</span> chunkId<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> installedChunks<span class="token punctuation">[</span>chunkId<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  							<span class="token comment">// installedChunks[chunkId][0] 就是 promise resolve 函数</span>
<span class="token comment">/******/</span> 				resolves<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>installedChunks<span class="token punctuation">[</span>chunkId<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/******/</span> 			<span class="token punctuation">}</span>
              <span class="token comment">// 标记该chunk已经加载完成，0即完成</span>
<span class="token comment">/******/</span> 			installedChunks<span class="token punctuation">[</span>chunkId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token comment">/******/</span> 		<span class="token punctuation">}</span>
            <span class="token comment">// 把所有的模块加入 modules 的对象中, 就是 __webpack_require__.m 对应的那个属性</span>
<span class="token comment">/******/</span> 		<span class="token keyword">for</span><span class="token punctuation">(</span>moduleId <span class="token keyword">in</span> moreModules<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">/******/</span> 			<span class="token keyword">if</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>hasOwnProperty<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>moreModules<span class="token punctuation">,</span> moduleId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">/******/</span> 				modules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span> <span class="token operator">=</span> moreModules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">/******/</span> 			<span class="token punctuation">}</span>
<span class="token comment">/******/</span> 		<span class="token punctuation">}</span>
<span class="token comment">/******/</span> 		<span class="token keyword">if</span><span class="token punctuation">(</span>parentJsonpFunction<span class="token punctuation">)</span> <span class="token function">parentJsonpFunction</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/******/</span>    
<span class="token comment">/******/</span> 		<span class="token keyword">while</span><span class="token punctuation">(</span>resolves<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">/******/</span> 			resolves<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/******/</span> 		<span class="token punctuation">}</span>
<span class="token comment">/******/</span>
<span class="token comment">/******/</span> 		<span class="token comment">// add entry modules from loaded chunk to deferred list</span>
<span class="token comment">/******/</span> 		deferredModules<span class="token punctuation">.</span>push<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>deferredModules<span class="token punctuation">,</span> executeModules <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/******/</span>
<span class="token comment">/******/</span> 		<span class="token comment">// run deferred modules when all chunks ready</span>
  					<span class="token comment">// 这个函数也很重要，主要是就是执行入口文件，比如app.js</span>
<span class="token comment">/******/</span> 		<span class="token keyword">return</span> <span class="token function">checkDeferredModules</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/******/</span> 	<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>这个函数，接受一个数组参数，包括chunkid，moreModules模块列表，executeModules需要先执行的模块</p> <p>具体作用</p> <p>1、是用来标识该chunk加载完成，因为只有下载完才会执行这个callback函数</p> <p>2、把moreModules，也就是把第二个参数模块Map对象放到runtime最外层作用域的modules数组中，不然<code>__webpack_require__</code>拿不到模块</p> <p>3、resolve<code>__webpack_require__.e</code>函数加载chunk返回的promise，通知<code>__webpack_require__</code>函数加载和执行模块</p> <p>4、链式调用promise，把module当参数，执行用户定义的then回调</p> <p>5、带有入口文件的话，就先执行入口文件</p> <p><code>__webpack_require__.e</code>简化代码，分析如下</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 记录chunk状态</span>
<span class="token comment">// key: id, value: 状态</span>
<span class="token comment">// undefined: 未加载</span>
<span class="token comment">// 数组: 加载中</span>
<span class="token comment">// 0：已加载</span>
<span class="token keyword">var</span> installedChunks <span class="token operator">=</span> <span class="token punctuation">{</span>
  
<span class="token punctuation">}</span>

__webpack<span class="token punctuation">.</span>require__<span class="token punctuation">.</span><span class="token function-variable function">e</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">requireEnsure</span><span class="token punctuation">(</span>chunkId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> promises <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  
  <span class="token keyword">if</span> <span class="token punctuation">(</span>installedChunks<span class="token punctuation">[</span>chunkId<span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">new</span> <span class="token function">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	 		installedChunks<span class="token punctuation">[</span>chunkId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">]</span><span class="token punctuation">;</span>
 		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    promises<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>promise<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  	<span class="token keyword">var</span> script <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'script'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  	script<span class="token punctuation">.</span>charset <span class="token operator">=</span> <span class="token string">'utf-8'</span><span class="token punctuation">;</span>
  	script<span class="token punctuation">.</span>timeout <span class="token operator">=</span> <span class="token number">120</span><span class="token punctuation">;</span><span class="token comment">// 120s 过后就中断</span>
  
  	script<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token function">jsonpScriptSrc</span><span class="token punctuation">(</span>chunkId<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// src加载</span>
  
  	<span class="token function-variable function">onScriptComplete</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	<span class="token function">clearTimeout</span><span class="token punctuation">(</span>timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
  	<span class="token punctuation">}</span>
  
  	<span class="token keyword">var</span> timeout <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'timeout'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">120000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    script<span class="token punctuation">.</span>onerror <span class="token operator">=</span> script<span class="token punctuation">.</span>onload <span class="token operator">=</span> onScriptComplete<span class="token punctuation">;</span>
    document<span class="token punctuation">.</span>head<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
    
  	<span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>promises<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>可以看到，这个函数主要作用是加载chunk，还有个chunk添加loading状态</p> <p>这边还漏了个地方没讲，就是打包后的<code>async.js</code>文件分析，以及加载<code>async.js</code>过程</p> <p><code>async.js</code>文件</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">asyncModule</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async module'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> asyncModule<span class="token punctuation">;</span>
</code></pre></div><p>打包之后</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">(</span>window<span class="token punctuation">[</span><span class="token string">&quot;webpackJsonp&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> window<span class="token punctuation">[</span><span class="token string">&quot;webpackJsonp&quot;</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">&quot;async&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">{</span>

<span class="token comment">/***/</span> <span class="token string">&quot;./src/async.js&quot;</span><span class="token punctuation">:</span>
<span class="token comment">/*!**********************!*\
  !*** ./src/async.js ***!
  \**********************/</span>
<span class="token comment">/*! exports provided: default */</span>
<span class="token comment">/***/</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>module<span class="token punctuation">,</span> __webpack_exports__<span class="token punctuation">,</span> __webpack_require__<span class="token punctuation">)</span> <span class="token punctuation">{</span>

<span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span>
__webpack_require__<span class="token punctuation">.</span><span class="token function">r</span><span class="token punctuation">(</span>__webpack_exports__<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">asyncModule</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'async module'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/* harmony default export */</span> __webpack_exports__<span class="token punctuation">[</span><span class="token string">&quot;default&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>asyncModule<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/***/</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>可以看到，webpack也是把<code>async.js</code>函数包装了一层，先用<code>webpackJsonpCallback</code>函数标识该chunk加载完成，再把<code>async.js</code>内容放到模块数组中，然后在<code>index.js</code>的打包文件中加载再执行</p> <p>执行<code>async.js</code>里的<code>asyncModule</code>函数是在<code>index.js</code>文件里面的，往上看打包后的<code>index.js</code>文件，有个逻辑，也就是then回调里面的</p> <div class="language-js extra-class"><pre class="language-js"><code>__webpack_require__<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">/*! ./async */</span> <span class="token string">&quot;./src/async.js&quot;</span><span class="token punctuation">)</span>
</code></pre></div><p>其中，<code>async.js</code>模块内容是用<code>__webpack_require__</code>同步加载执行的，<code>__webpack_require__</code>函数是webpack加载模块的核心，先来看看这个函数源码</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span>moduleId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// Check if module is in cache</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>installedModules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> installedModules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">.</span>exports<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// Create a new module (and put it into the cache)</span>
	<span class="token keyword">var</span> module <span class="token operator">=</span> installedModules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
		i<span class="token punctuation">:</span> moduleId<span class="token punctuation">,</span>
		l<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
		exports<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>

	<span class="token comment">// Execute the module function</span>
  <span class="token comment">// 执行模块的函数体，也就是async打包后的包装函数</span>
 	<span class="token comment">// modules就是存放所有webpack模块的地方</span>
	modules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>module<span class="token punctuation">.</span>exports<span class="token punctuation">,</span> module<span class="token punctuation">,</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">,</span> __webpack_require__<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// Flag the module as loaded</span>
	module<span class="token punctuation">.</span>l <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
	<span class="token comment">// Return the exports of the module</span>
	<span class="token keyword">return</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>加载的原理也很简单了，就是一行代码，从<code>modules</code>里面取模块加载</p> <div class="language-js extra-class"><pre class="language-js"><code>modules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>module<span class="token punctuation">.</span>exports<span class="token punctuation">,</span> module<span class="token punctuation">,</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">,</span> __webpack_require__<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>对应着<code>async.js</code>包装函数</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>module<span class="token punctuation">,</span> __webpack_exports__<span class="token punctuation">,</span> __webpack_require__<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><p>所以，在异步模块加载之前，一定要把模块放到<code>modules</code>变量里面，然后在用<code>__webpack_require__</code>执行即可</p> <p>附上流程图</p> <p><img src="/Notebook/assets/img/image-20201202181100446.196b4283.png" alt="image-20201202181100446"></p> <p>所以，完全可以让异步chunk在浏览器空闲的时候下载，因为这些chunk下载不需要先后固定顺序，可以用prefetch对某些异步路由进行提前下载，提供加载速度。</p> <p>看完源码不得不惊叹，这些加载过程不需要很多代码，就能把chunk之前完全解耦开，闭包玩得太妙了。</p> <h3 id="webpack-模块在运行时是怎么存的？"><a href="#webpack-模块在运行时是怎么存的？" aria-hidden="true" class="header-anchor">#</a> webpack 模块在运行时是怎么存的？</h3> <p>每个模块都存在webpack函数中的<code>modules</code>数组变量里面，比如一个id为1的模块</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> modules <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

modules<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  i<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// 模块id</span>
	l<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 是否已经加载</span>
	exports<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// 导出的值</span>
<span class="token punctuation">}</span>
</code></pre></div><p>其中，通过一个表来进行存储，键为模块id，值为一个对象，里面包含了模块属性。</p> <h3 id="webpack-持久化-chunk-缓存方案"><a href="#webpack-持久化-chunk-缓存方案" aria-hidden="true" class="header-anchor">#</a> webpack 持久化 chunk 缓存方案</h3> <p>js、css文件不能使用hash，图片、字体、svg文件可以使用hash</p> <p>css使用contentHash，使用chunkHash会使得跟其有css文件关联的js文件hash值都改变</p> <p>js现在也可以使用contentHash了，但是有些旧版本webpack是不支持的</p> <p>如果js用chunkHash的话，采用以下方案</p> <p>1、需要用HashedModuleIdsPlugin固定住moduleId(如果不使用，webpack则会使用自增的id，当增加或者删除module的时候，id就会发生变化，没有改过的文件的id也变了，缓存失效)，HashedModuleIdsPlugin是把路径hash化当成模块id</p> <p>2、使用NamedChunkPlugin+魔法注释来固定住chunkId</p> <p>到了webpack5.0，moduleId和chunkId问题都可以不用插件解决，直接使用</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
 optimization<span class="token punctuation">:</span><span class="token punctuation">{</span>
  chunkIds<span class="token punctuation">:</span> <span class="token string">&quot;deterministic&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 在不同的编译中不变的短数字 id</span>
	moduleIds<span class="token punctuation">:</span> <span class="token string">&quot;deterministic&quot;</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>还有一个很重要，但是vuecli却没内置的方案，也就是要把引导模板给提取出来</p> <p>为什么要提取？这边简单说下</p> <p>比如在vuecli创建的工程项目中，有一个懒加载路由<code>About.vue</code>，打包出来会有<code>app.contenthash.js</code>和<code>about.contenthash.js</code>，如果我修改了<code>About.vue</code>内容，打包出来的<code>about.contenthash.js</code>文件hash必然会变，但是你会发现，<code>app.contentHash.js</code>也跟着变了，如果在大型项目中这样搞，改了一个路由页面，导致<code>app.js</code>也变，这样就使得<code>app.js</code>缓存失效了，这文件还不小。</p> <p>为什么<code>app.js</code>会变，怎么解决？</p> <p>这里有个引导模板的概念，也就是webpack加载bundle的一些前置函数，例如webpackJsonpCallback、webpack-require、还是script src加载这些，这些函数是不会变的，但是里面的chunk文件映射关系会变，所谓的映射关系，可以看这个函数</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">jsonpScriptSrc</span><span class="token punctuation">(</span>chunkId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> __webpack_require__<span class="token punctuation">.</span>p <span class="token operator">+</span> <span class="token string">&quot;&quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">[</span>chunkId<span class="token punctuation">]</span><span class="token operator">||</span>chunkId<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;.&quot;</span> <span class="token operator">+</span> <span class="token punctuation">{</span><span class="token string">&quot;about&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;c19c62a2&quot;</span><span class="token punctuation">}</span><span class="token punctuation">[</span>chunkId<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">&quot;.js&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>可以看到，chunk文件id和hash值的映射都在这个函数里面，比如一个chunk叫<code>about.c19c62a2.js</code>，在引导模板中就为<code>{ about: &quot;c5988801&quot; }</code>，所以每个chunk文件的id变动都会改变这个映射关系，<code>About.vue</code>的id变了，当然这个引导模板文件也会变，引导模板又默认放到<code>app.js</code>里面，所以需要把这个引导模板抽取出来，独立加载，不要影响<code>app.js</code>的hash值</p> <p>解决方法，webpack添加以下配置</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
 	optimization<span class="token punctuation">:</span> <span class="token punctuation">{</span>
   runtimeChunk<span class="token punctuation">:</span> <span class="token string">'single'</span> <span class="token comment">// true 也可以，不过每个entry chunk就有一个runtime</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这样就可以把runtimeChunk打包出来，<code>app.js</code>不会因为<code>about.js</code>变化而改变</p> <p>但是还有个问题，这个chunk很小，没必要消耗一次http请求，不然请求时间会大于加载时间，所以直接内联到html模板里面就可以了</p> <p>可以用<code>script-ext-html-webpack-plugin</code>插件实现</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> ScriptExtHtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'script-ext-html-webpack-plugin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  productionSourceMap<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  configureWebpack<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    optimization<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      runtimeChunk<span class="token punctuation">:</span> <span class="token string">'single'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token keyword">new</span> <span class="token class-name">ScriptExtHtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        inline<span class="token punctuation">:</span> <span class="token regex">/runtime.+\.js$/</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  chainWebpack<span class="token punctuation">:</span> config <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    config<span class="token punctuation">.</span><span class="token function">plugin</span><span class="token punctuation">(</span><span class="token string">'preload'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span>args <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>fileBlacklist<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token regex">/runtime.+\.js$/</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> args
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="如果获取页面fp和fcp的时间"><a href="#如果获取页面fp和fcp的时间" aria-hidden="true" class="header-anchor">#</a> 如果获取页面FP和FCP的时间</h3> <p>FP(首次绘制)</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> fp <span class="token operator">=</span> performance<span class="token punctuation">.</span><span class="token function">getEntriesByType</span><span class="token punctuation">(</span><span class="token string">'paint'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>startTime<span class="token punctuation">;</span>
</code></pre></div><p>FCP(首次内容绘制)</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> fcp <span class="token operator">=</span> performance<span class="token punctuation">.</span><span class="token function">getEntriesByType</span><span class="token punctuation">(</span><span class="token string">'paint'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>startTime<span class="token punctuation">;</span>
</code></pre></div><div class="to-top"><svg t="1547627942927" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1955" xmlns:xlink="http://www.w3.org/1999/xlink" width="64" height="64" class="icon"><path d="M752.736 431.063C757.159 140.575 520.41 8.97 504.518 0.41V0l-0.45 0.205-0.41-0.205v0.41c-15.934 8.56-252.723 140.165-248.259 430.653-48.21 31.457-98.713 87.368-90.685 184.074 8.028 96.666 101.007 160.768 136.601 157.287 35.595-3.482 25.232-30.31 25.232-30.31l12.206-50.095s52.47 80.569 69.304 80.528c15.114-1.23 87-0.123 95.6 0h0.82c8.602-0.123 80.486-1.23 95.6 0 16.794 0 69.305-80.528 69.305-80.528l12.165 50.094s-10.322 26.83 25.272 30.31c35.595 3.482 128.574-60.62 136.602-157.286 8.028-96.665-42.475-152.617-90.685-184.074z m-248.669-4.26c-6.758-0.123-94.781-3.359-102.891-107.192 2.95-98.714 95.97-107.438 102.891-107.93 6.964 0.492 99.943 9.216 102.892 107.93-8.11 103.833-96.174 107.07-102.892 107.192z m-52.019 500.531c0 11.838-9.42 21.382-21.012 21.382a21.217 21.217 0 0 1-21.054-21.34V821.74c0-11.797 9.421-21.382 21.054-21.382 11.591 0 21.012 9.585 21.012 21.382v105.635z m77.333 57.222a21.504 21.504 0 0 1-21.34 21.626 21.504 21.504 0 0 1-21.34-21.626V827.474c0-11.96 9.543-21.668 21.299-21.668 11.796 0 21.38 9.708 21.38 21.668v157.082z m71.147-82.043c0 11.796-9.42 21.34-21.053 21.34a21.217 21.217 0 0 1-21.013-21.34v-75.367c0-11.755 9.421-21.299 21.013-21.299 11.632 0 21.053 9.544 21.053 21.3v75.366z" fill="#3eaf7c" p-id="1956"></path></svg></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">1/10/2021, 10:11:46 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Notebook/dailyRecord/2021.html" class="prev">
        2021
      </a></span> <span class="next"><a href="/Notebook/dailyRecord/2019.html">
        2019
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/Notebook/assets/js/app.51035dcd.js" defer></script><script src="/Notebook/assets/js/21.b8066a1d.js" defer></script><script src="/Notebook/assets/js/15.b864e6b5.js" defer></script><script src="/Notebook/assets/js/19.17673ac2.js" defer></script>
  </body>
</html>
